Matter.Body.update=function(t,e,i,n){var o=Matter.Bounds,s=Matter.Vector,r=Matter.Vertices,a=Matter.Axes,h=Math.pow(e*i*t.timeScale,2),c=1-t.frictionAir*i*t.timeScale,d=t.position.x-t.positionPrev.x,l=t.position.y-t.positionPrev.y;t.velocity.x=d*c*n+t.force.x/t.mass*h,t.velocity.y=l*c*n+t.force.y/t.mass*h,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.canRotate?t.angularVelocity=(t.angle-t.anglePrev)*c*n+t.torque/t.inertia*h:t.angularVelocity=0,t.anglePrev=t.angle,t.angle+=t.angularVelocity,t.speed=s.magnitude(t.velocity),t.angularSpeed=Math.abs(t.angularVelocity);for(var p=0;p<t.parts.length;p++){var u=t.parts[p];r.translate(u.vertices,t.velocity),p>0&&(u.position.x+=t.velocity.x,u.position.y+=t.velocity.y),0!==t.angularVelocity&&(r.rotate(u.vertices,t.angularVelocity,t.position),a.rotate(u.axes,t.angularVelocity),p>0&&s.rotateAbout(u.position,t.angularVelocity,t.position,u.position)),o.update(u.bounds,u.vertices,t.velocity)}};var se={};"undefined"!=typeof window&&(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(Date.now())},1e3/60)}}(),window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame),se.inherit=function(t,e){var i=Object.create(t.prototype);e.prototype=i,e.prototype.constructor=e},se.RectCollider=function(t){t=t||{},this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.id=null,this.isStatic=!1,void 0!==t.isStatic&&(this.isStatic=t.isStatic)},se.RectCollider.createByExtent=function(t){return new se.RectCollider(t.min.x,t.min.y,t.max.x,t.max.y)},se.RectCollider.prototype.setParent=function(t){if(this.parent=t,void 0===this.width){var e=t.mesh.getExtent();this.x=e.min.x,this.y=e.min.y,this.width=e.max.x,this.height=e.max.y}},se.RectCollider.prototype.getExtent=function(){var t=this.parent,e=t.transform.getRealPosition();return new se.Extent(e.x,e.y,e.x+this.width,e.y+this.height)},se.RectCollider.prototype.isIntersect=function(t){var e=this.getExtent(),i=t.getExtent();return e.intersects(i)},se.RectCollider.prototype.getIntersection=function(t){if(!(t instanceof Array))return this._getIntersection(t);for(var e=0;e<t.length;e++){var i=t[e];if(this._isIntersect(i))return this._getIntersection(i)}return null},se.RectCollider.prototype._getIntersection=function(t){var e=this.getExtent(),i=t.getExtent();return e.getIntersection(i)},se.RectCollider.prototype.resolveCollision=function(t){this.parent.resolveCollision(t)},se.RectCollider.prototype.setStatic=function(t){this.isStatic=t},se.RectCollider.prototype.clone=function(){return new se.RectCollider(this.x,this.y,this.width,this.height)},se.Component=function(){},se.Component.prototype.update=function(){},se.Component.prototype.resolveCollision=function(){},se.Component.prototype.setParent=function(t){this.parent=t},se.Extent=function(t,e,i,n){this.min={x:t,y:e},this.max={x:i,y:n}},se.Extent.createEmpty=function(){return new se.Extent(1/0,1/0,(-(1/0)),(-(1/0)))},se.Extent.prototype.clone=function(){return new se.Extent(this.min.x,this.min.y,this.max.x,this.max.y)},se.Extent.prototype.move=function(t){return this.min.x+=t.x,this.min.y+=t.y,this.max.x+=t.x,this.max.y+=t.y,this},se.Extent.prototype.extend=function(t){return t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.y<this.min.y&&(this.min.y=t.min.y),t.max.y>this.max.y&&(this.max.y=t.max.y),this},se.Extent.prototype.extendVector=function(t){return t.x<this.min.x&&(this.min.x=t.x),t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y&&(this.min.y=t.y),t.y>this.max.y&&(this.max.y=t.y),this},se.Extent.prototype.extendVectors=function(t){for(var e=0;e<t.length;e++)this.extendVector(t[e]);return this},se.Extent.prototype.intersects=function(t){return this.min.x<=t.max.x&&this.max.x>=t.min.x&&this.min.y<=t.max.y&&this.max.y>=t.min.y},se.Extent.prototype.getIntersection=function(t){var e=se.Extent.createEmpty();return this.intersects(t)?(this.min.x>t.min.x?e.min.x=this.min.x:e.min.x=t.min.x,this.min.y>t.min.y?e.min.y=this.min.y:e.min.y=t.min.y,this.max.x<t.max.x?e.max.x=this.max.x:e.max.x=t.max.x,this.max.y<t.max.y?e.max.y=this.max.y:e.max.y=t.max.y,e):null},se.Extent.prototype.getWidth=function(){return this.max.x-this.min.x},se.Extent.prototype.getHeight=function(){return this.max.y-this.min.y},se.Extent.prototype.containsXY=function(t,e){return this.min.x<=t&&t<=this.max.x&&this.min.y<=e&&e<=this.max.y},se.Extent.prototype.getCenter=function(){return new se.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2)},se.factory={},se.factory.rect=function(t){var e=t||{},i=e.name||"",n=e.x||0,o=e.y||0,s=e.w||10,r=e.h||10,a=e.image_src,h=e.fillColor||"#6B4226",c=e.rigidopts||{},d=!1;null!==t.isStatic&&void 0!==t.isStatic&&(d=t.isStatic),void 0===e.hasRigidbody&&(e.hasRigidbody=!0);var l=[new se.Point(-s/2,-r/2),new se.Point(s/2,-r/2),new se.Point(s/2,r/2),new se.Point(-s/2,r/2)],p=new se.GameObject(i,n,o,{vertices:l,isStatic:d});return e.hasRigidbody&&p.setRigidBody(new se.RigidBody(c)),a?p.setRenderer(new se.ImageRenderer(a,s,r)):p.setRenderer(new se.RectRenderer(h,s,r)),p},se.factory.circle=function(t){var e=t||{},i=e.name||"",n=e.x||0,o=e.y||0,s=e.radius||10,r=e.rigidopts||{},a=e.maxSides||25,h=!1;null!==t.isStatic&&void 0!==t.isStatic&&(h=t._isStatic),void 0===e.hasRigidbody&&(e.hasRigidbody=!0);var c=e.fillColor,d=e.strokeColor,l=e.lineWidth,p=se.factory.createCircleVertices(s,a);p=se.load.points(p);var u=new se.GameObject(i,n,o,{vertices:p,isStatic:h});return e.hasRigidbody&&u.setRigidBody(new se.RigidBody(r)),u.setRenderer(new se.CircleRenderer(s,c,d,l)),u},se.factory.createCircleVertices=function(t,e){e=e||25;var i=Math.ceil(Math.max(10,Math.min(e,t)));i%2===1&&(i+=1);for(var n=2*Math.PI/i,o="",s=.5*n,r=0;r<i;r++){var a=s+r*n,h=Math.cos(a)*t,c=Math.sin(a)*t;o+="L "+h.toFixed(3)+" "+c.toFixed(3)+" "}return Matter.Vertices.fromPath(o)},se.GameObject=function(t,e,i,n){this.name=t,this.transform=new se.Transform(this,e,i),this.components=[],this.colliders=[],this.renderer=null,this.parent=null,this.children=[],this._id=null,n=n||{};var o=n.vertices||[];this.setMesh(new se.Mesh(o)),this.rigidbody=n.rigidbody||null,this.angle=n.angle||0,this._isStatic=!1,null!==n.isStatic&&void 0!==n.isStatic&&(this._isStatic=n.isStatic)},se.GameObject.prototype.getX=function(){return this.transform.position.x},se.GameObject.prototype.getY=function(){return this.transform.position.y},se.GameObject.prototype.getWidth=function(){return this.width},se.GameObject.prototype.getHeight=function(){return this.height},se.GameObject.prototype.id=function(t){return arguments.length&&(this._id=t),this._id},se.GameObject.prototype.getScene=function(){for(var t=this.parent;null!==t&&t instanceof se.Scene==!1;)t=t.parent;return t},se.GameObject.prototype.getColliders=function(){return this.colliders},se.GameObject.prototype.setRenderer=function(t){t.setParent(this),this.renderer=t},se.GameObject.prototype.getRenderer=function(){return this.renderer},se.GameObject.prototype.getChildren=function(){return this.children},se.GameObject.prototype.update=function(t,e){var i=this.rigidbody;i&&this.rigidbody.update(t,e);for(var n=0;n<this.components.length;n++)this.components[n].update(this,t,e);for(var o=0;o<this.children.length;o++)this.children[o].update(t,e)},se.GameObject.prototype.resolveCollision=function(t){for(var e=0;e<this.components.length;e++){var i=this.components[e];i.resolveCollision&&i.resolveCollision(t)}},se.GameObject.prototype.render=function(t){var e=this,i=e.transform.position,n=e.transform.rotate;t.translate(i.x,i.y),t.rotate(e.angle),t.scale(n.x,1),this.renderer&&this.renderer.render(t);for(var o=0;o<this.children.length;o++)this.children[o].render(t);t.scale(n.x,1),t.rotate(-e.angle),t.translate(-i.x,-i.y)},se.GameObject.prototype.addComponent=function(t){return this.components.push(t),t.setParent(this),this},se.GameObject.prototype.addCollider=function(t){return this.colliders.push(t),t.setParent(this),this},se.GameObject.prototype.setRigidBody=function(t){return this.rigidbody=t,t.setParent(this),this},se.GameObject.prototype.setParent=function(t){this.parent=t},se.GameObject.prototype.getParent=function(){return this.parent},se.GameObject.prototype.add=function(t){t instanceof se.GameObject&&this.addChild(t)},se.GameObject.prototype.addChild=function(t){t.destroy(),this.children.push(t),this.initChild(t)},se.GameObject.prototype.addAtIndex=function(t,e){t.destroy();var i=this.children.splice(e);this.children.push(t);for(var n=0;n<i.length;n++)this.children.push(i[n]);this.initChild(t)},se.GameObject.prototype.addAfter=function(t,e){t.destroy();var i=this.children.indexOf(e);i===-1?this.addChild(t):this.addAtIndex(t,i+1)},se.GameObject.prototype.initChild=function(t){t.setParent(this);var e=this.getScene();if(e&&e.setIdInObj(t),t.rigidbody){t.rigidbody.updateRealPosition();for(var i=this,n=!0;n;)i?i instanceof se.Scene?(n=!1,i.addBody(t.rigidbody.body)):i.rigidbody?(this.rigidbody.addChild(t.rigidbody.body),n=!1):i=i.parent:n=!1}},se.GameObject.prototype.remove=function(t){t.setParent(null);var e=this.children.indexOf(t);e!==-1&&this.children.splice(e,1);var i=this.getScene();i&&i.remove(t)},se.GameObject.prototype.destroy=function(){this.parent&&this.parent.remove(this)},se.GameObject.prototype.setMesh=function(t){this.mesh=t,t.setParent(this)},se.GameObject.prototype.isStatic=function(t){return arguments.length&&null!==t&&void 0!==t&&(this._isStatic=t,this.rigidbody&&this.rigidbody.body&&Matter.Body.setStatic(this.rigidbody.body,t)),this._isStatic},se.GameObject.prototype.clone=function(){var t={vertices:this.mesh.vertices,angle:this.angle,isStatic:this.isStatic()},e=this.transform.position.x,i=this.transform.position.y,n=new this.constructor(this.name,e,i,t);if(this.rigidbody){var o=this.rigidbody.body,s={canRotate:o.canRotate};n.setRigidBody(new se.RigidBody(s))}if(this.renderer){var r=this.renderer.clone();n.setRenderer(r)}for(var a=0;a<this.children.length;a++){var h=this.children[a];n.addChild(h.clone())}return n},se.GameObject.prototype.json=function(){var t=null;this.rigidbody&&(t=this.rigidbody.json());var e=null;this.renderer&&(e=this.renderer.json());for(var i=[],n=0;n<this.children.length;n++)i.push(this.children[n].json());return{type:"GameObject",name:this.name,angle:this.angle,isStatic:this.isStatic(),transform:this.transform.json(),mesh:this.mesh.json(),rigidbody:t,children:i,renderer:e}},se.Transform=function(t,e,i){this.parent=t,this.position=new se.Point(e,i),this.rotate=new se.Point(1,0)},se.Transform.prototype.change=function(t,e){var i=this.parent.rigidbody;i?i.setPosition({x:t,y:e}):this.position.change(t,e)},se.Transform.prototype.move=function(t,e){this.position.x+=t,this.position.y+=e},se.Transform.prototype.getRealPosition=function(){var t=this.position,e=this.parent,i=e.parent;if(i instanceof se.GameObject){var n=i.transform.getRealPosition();t=t.add(n)}return t},se.Transform.prototype.json=function(){return{type:"Transform",position:this.position.json(),rotate:this.rotate.json()}},se.Interaction=function(){},se.Interaction.prototype.active=function(){},se.Interaction.prototype.desactive=function(){},se.Interaction.prototype.setParent=function(t){this.parent=t,this.active()},se.Interaction.prototype.parseTouchToVector=function(t){return new se.Point(t.pageX,t.pageY)},se.Joystick=function(){this.x=0,this.y=0,this.jump=!1,this.keyhandler=new se.KeyboardHandler(this)},se.Joystick.prototype.getAxis=function(t){return"horizontal"===t?this.x:"vertical"===t?this.y:"jump"===t?this.jump:0},se.Joystick.prototype.setAxis=function(t,e){"horizontal"===t&&(this.x=e),"vertical"===t&&(this.y=e),"jump"===t&&(this.jump=e)},se.Joystick.prototype.resetAxis=function(){this.x=0,this.y=0,this.jump=!1},se.KeyboardHandler=function(t){var e=this;this.joy=t,document.addEventListener("keydown",function(t){var i=parseInt(t.keyCode,0);e.keydown(i)}),document.addEventListener("keyup",function(t){var i=parseInt(t.keyCode,0);e.keyup(i)})},se.KeyboardHandler.prototype.keydown=function(t){65===t||37===t?this.joy.setAxis("horizontal",-1):68===t||39===t?this.joy.setAxis("horizontal",1):87===t||38===t?this.joy.setAxis("vertical",-1):83===t||40===t?this.joy.setAxis("vertical",1):32===t&&this.joy.setAxis("jump",!0)},se.KeyboardHandler.prototype.keyup=function(t){65===t||68===t||37===t||39===t?this.joy.setAxis("horizontal",0):87===t||83===t||38===t||40===t?this.joy.setAxis("vertical",0):32===t&&this.joy.setAxis("jump",!1)},se.load={},se.load.scene=function(t){var e=null;t.renderer&&(e=se.load.renderer(t.renderer));for(var i=new se.Scene(e,(!0)),n=0;n<t.objs.length;n++){var o=t.objs[n],s=se.load.gameobject(o);i.add(s)}return i.setCamera(t.indexCamera),i.zoomCamera=t.zoomCamera,i},se.load.gameobject=function(t){var e=se.load.points(t.mesh.vertices),i={angle:t.angle,isStatic:t.isStatic,vertices:e},n=t.transform.position,o=new se.GameObject(t.name,n.x,n.y,i);if(t.rigidbody&&o.setRigidBody(new se.RigidBody(t.rigidbody)),t.renderer){var s=se.load.renderer(t.renderer);o.setRenderer(s)}for(var r=0;r<t.children.length;r++){var a=t.children[r],h=se.load.gameobject(a);o.addChild(h)}return o},se.load.point=function(t){return new se.Point(t.x,t.y)},se.load.points=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i],o=se.load.point(n);e.push(o)}return e},se.load.renderer=function(t){var e=null;return"CircleRenderer"===t.type?e=new se.CircleRenderer(t.radius,t.fillStyle,t.strokeStyle,t.lineWidth):"RectRenderer"===t.type?e=new se.RectRenderer(t.color,t.width,t.height):"MeshRenderer"===t.type?e=new se.MeshRenderer(t.fillColor,t.strokeStyle,t.lineWidth):"ImageRenderer"===t.type?e=new se.ImageRenderer(t.imageSrc,t.width,t.height):"GradientRenderer"===t.type&&(e=new se.GradientRenderer(t.color1,t.color2)),e},se.Mesh=function(t){this.vertices=t||[];var e=Matter.Vertices.centre(t);Matter.Vertices.translate(t,e,-1)},se.Mesh.prototype.setVertices=function(t){this.vertices=t},se.Mesh.prototype.getVertices=function(){return this.vertices},se.Mesh.prototype.addVertice=function(t){this.vertices.push(t)},se.Mesh.prototype.getExtent=function(){var t=this.parent.transform.getRealPosition(),e=se.Extent.createEmpty();return e.extendVectors(this.vertices),e.move(t)},se.Mesh.prototype.setParent=function(t){this.parent=t},se.Mesh.prototype.json=function(){for(var t=[],e=0;e<this.vertices.length;e++)t.push(this.vertices[e].json());return{type:"Mesh",vertices:t}},se.Point=function(t,e){this.x=t,this.y=e},se.Point.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},se.Point.prototype.clone=function(){return new se.Point(this.x,this.y)},se.Point.prototype.change=function(t,e){this.x=t,this.y=e},se.Point.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},se.Point.prototype.sub=function(t,e){var i=e?this:new se.Point(0,0);return i.x=this.x-t.x,i.y=this.y-t.y,i},se.Point.prototype.add=function(t,e){var i=e?this:new se.Point(0,0);return i.x=this.x+t.x,i.y=this.y+t.y,i},se.Point.prototype.div=function(t,e){var i=e?this:new se.Point(0,0);return i.x=this.x/t.x,i.y=this.y/t.y,i},se.Point.prototype.mul=function(t,e){var i=e?this:new se.Point(0,0);return i.x=this.x*t.x,i.y=this.y*t.y,i},se.Point.prototype.neg=function(t){var e=t?this:new se.Point(0,0);return e.x=this.x*-1,e.y=this.y*-1,e},se.Point.prototype.calcDistance=function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)},se.Point.prototype.json=function(){return{type:"Point",x:this.x,y:this.y}},se.Renderer=function(){},se.Renderer.prototype.render=function(){},se.Renderer.prototype.setParent=function(t){this.parent=t},se.Renderer.prototype.clone=function(){var t=new this.constructor;for(var e in this)({}).hasOwnProperty.call(this,e)&&(t[e]=this[e]);return t},se.Renderer.prototype.json=function(){return{type:"Renderer"}},se.RigidBody=function(t){this.options=t||{}},se.RigidBody.prototype.createBody=function(){var t=this.parent,e=this.options||{},i=e.name||t.name;void 0===e.canRotate&&(e.canRotate=!0);var n={label:i,position:{x:0,y:0},vertices:t.mesh.getVertices(),angle:t.angle,isStatic:t.isStatic()};this.body=Matter.Body.create(Matter.Common.extend({},n,e)),this.updateRealPosition()},se.RigidBody.prototype.update=function(){var t=this.parent.transform.position;t.x=this.body.position.x,t.y=this.body.position.y,this.parent.angle=this.body.angle},se.RigidBody.prototype.setParent=function(t){this.parent=t,this.createBody()},se.RigidBody.prototype.setVelocity=function(t){Matter.Sleeping.set(this.body,!1),Matter.Body.setVelocity(this.body,t)},se.RigidBody.prototype.applyForce=function(t,e){Matter.Body.applyForce(this.body,t,e)},se.RigidBody.prototype.setAngularVelocity=function(t){Matter.Body.setAngularVelocity(this.body,t)},se.RigidBody.prototype.setPosition=function(t){Matter.Body.setPosition(this.body,t)},se.RigidBody.prototype.addChild=function(t){var e=this.body.parts.slice(1);e.push(t),Matter.Body.setParts(this.body,e)},se.RigidBody.prototype.updateRealPosition=function(){var t=this.parent.transform.getRealPosition();Matter.Body.setPosition(this.body,t)},se.RigidBody.prototype.json=function(){return{isStatic:this.body.isStatic,canRotate:this.body.canRotate}},se.Scene=function(t,e){if(this.objs=[],this.colliders=[],this.collisionsActive={},this.sequence=-1,this.indexObjs={},!e){var i=new se.GameObject("MainCamera",0,0,0,0);this.add(i)}this._indexCamera=0,this.zoomCamera=1,this.renderer=t||new se.GradientRenderer("#004CB3","#8ED6FF"),this.renderer.setParent(this),this.matterengine=Matter.Engine.create(),this.matterengine.enableSleeping=!0},se.Scene.prototype.getCamera=function(){return this.objs[this._indexCamera]},se.Scene.prototype.setCamera=function(t){if("number"==typeof t)this._indexCamera=t;else{var e=this.objs.indexOf(t);e!==-1&&(this._indexCamera=e)}},se.Scene.prototype.getObjs=function(){return this.objs},se.Scene.prototype.setParent=function(t){this.parent=t},se.Scene.prototype.add=function(t){t.destroy(),this.objs.push(t),this.initChild(t)},se.Scene.prototype.addAtIndex=function(t,e){t.destroy();var i=this.objs.splice(e);this.objs.push(t);for(var n=0;n<i.length;n++)this.objs.push(i[n]);this.initChild(t)},se.Scene.prototype.addAfter=function(t,e){t.destroy();var i=this.objs.indexOf(e);i===-1?this.addChild(t):this.addAtIndex(t,i+1)},se.Scene.prototype.initChild=function(t){t.setParent(this);var e=t.getChildren();if(t.rigidbody)this.addBody(t.rigidbody.body);else for(var i=e.length-1;i>=0;i--){var n=e[i];this.addBody(n.rigidbody.body)}this.addColliders(t.getColliders()),this.setIdInObj(t)},se.Scene.prototype.remove=function(t){t.setParent(null);for(var e=t.getColliders(),i=0;i<e.length;i++)this.removeCollider(e[i]);t.rigidbody&&this.removeBody(t.rigidbody.body);var n=this.objs.indexOf(t);n!==-1&&this.objs.splice(n,1),delete this.indexObjs[t.id()]},se.Scene.prototype.setIdInObj=function(t){t.id(this.nextId()),this.indexObjs[t.id()]=t;for(var e=0;e<t.children.length;e++){var i=t.children[e];this.setIdInObj(i)}},se.Scene.prototype.nextId=function(){return this.sequence++,this.sequence},se.Scene.prototype.getObj=function(t){return this.indexObjs[t]},se.Scene.prototype.addBody=function(t){var e=this.matterengine;Matter.World.add(e.world,t)},se.Scene.prototype.removeBody=function(t){var e=this.matterengine;Matter.Composite.removeBody(e.world,t)},se.Scene.prototype.addColliders=function(t){for(var e=0;e<t.length;e++){var i=t[e];this.addCollider(i)}},se.Scene.prototype.addCollider=function(t){this.colliders.push(t),t.id=this.colliders.length-1},se.Scene.prototype.removeCollider=function(t){var e=this.colliders.indexOf(t);e!==-1&&this.colliders.splice(e,1)},se.Scene.prototype.update=function(t,e){Matter.Engine.update(this.matterengine,t,e),this.checkColliders();for(var i=0;i<this.objs.length;i++){var n=this.objs[i];n.update(t,e)}},se.Scene.prototype.checkColliders=function(){var t=this.collisionsActive;this.collisionsActive={};for(var e=[],i=0;i<this.colliders.length-1;i++)for(var n=this.colliders[i],o=i+1;o<this.colliders.length;o++){var s=this.colliders[o];if((!n.isStatic||!s.isStatic)&&n.isIntersect(s)){var r=n.id+"-"+s.id,a={a:n,b:s};this.collisionsActive[r]=a,void 0===t[r]&&e.push(a)}}for(var h=0;h<e.length;h++){var c=e[h];c.a.resolveCollision(c.b),c.b.resolveCollision(c.a)}},se.Scene.prototype.render=function(t){for(var e=0;e<this.objs.length;e++)this.objs[e].render(t)},se.Scene.prototype.clone=function(){for(var t=new se.Scene(this.renderer,(!0)),e=this.getObjs(),i=0;i<e.length;i++){var n=e[i],o=n.clone();t.add(o)}return t.setCamera(this._indexCamera),t.zoomCamera=this.zoomCamera,t},se.Scene.prototype.getObjectFromCoordinate=function(t){for(var e=this.getObjs(),i=e.length-1;i>=0;i--){var n=e[i];if(n.mesh.getExtent().containsXY(t.x,t.y))return n;for(var o=n.getChildren(),s=o.length-1;s>=0;s--){var r=o[s];if(r.mesh.getExtent().containsXY(t.x,t.y))return r}}},se.Scene.prototype.json=function(){for(var t=[],e=0;e<this.objs.length;e++)t.push(this.objs[e].json());return{type:"Scene",renderer:this.renderer.json(),objs:t,indexCamera:this._indexCamera,zoomCamera:this.zoomCamera}},se.StarEngine=function(t){this.element=t,this.scenes=[],this.joystick=new se.Joystick;var e={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0,timing:{timestamp:0,timeScale:1}},i=e;i.delta=i.delta||1e3/i.fps,i.deltaMin=i.deltaMin||1e3/i.fps,i.deltaMax=i.deltaMax||1e3/(.5*i.fps),i.fps=1e3/i.delta,this.runner=i},se.StarEngine.prototype.getSceneCurrent=function(){return this.scenes[0]},se.StarEngine.prototype.addScene=function(t){this.scenes.push(t),t.setParent(this)},se.StarEngine.prototype.update=function(t){var e,i=this.runner,n=i.timing,o=1;i.isFixed?e=i.delta:(e=t-i.timePrev||i.delta,i.timePrev=t,i.deltaHistory.push(e),i.deltaHistory=i.deltaHistory.slice(-i.deltaSampleSize),e=Math.min.apply(null,i.deltaHistory),e=e<i.deltaMin?i.deltaMin:e,e=e>i.deltaMax?i.deltaMax:e,o=e/i.delta,i.delta=e),0!==i.timeScalePrev&&(o*=n.timeScale/i.timeScalePrev),0===n.timeScale&&(o=0),i.timeScalePrev=n.timeScale,i.correction=o,i.frameCounter+=1,t-i.counterTimestamp>=1e3&&(i.fps=i.frameCounter*((t-i.counterTimestamp)/1e3),i.counterTimestamp=t,i.frameCounter=0)},se.StarEngine.prototype.run=function(){var t=this.runner,e=this;return this.viewport=this.viewport||null,!this.viewport&&this.element&&(this.viewport=new se.ViewPort(this.element)),function i(n){t.frameRequestId=window.requestAnimationFrame(i);var o=e.getSceneCurrent();n&&(e.update(n),t.enabled&&o.update(t.delta,t.correction)),e.viewport&&e.viewport.render(o)}(),t},se.StarEngine.prototype.pause=function(t){void 0===t&&(t=!0),this.runner.enabled=!t},se.ViewPort=function(t){var e=this;if(this.interactions=[],this._scale=1,t?"string"==typeof t?this.element=window.document.querySelector(t):this.element=t:this.element=window.document.body,"CANVAS"!==this.element.nodeName){var i=this.element;this.element=window.document.createElement("canvas"),i.appendChild(this.element)}this.pivot=new se.Transform(this,0,0),this.element.getContext&&(this.ctx=this.element.getContext("2d")),window.addEventListener("resize",function(){e.updateSize()}),e.updateSize()},se.ViewPort.prototype.getContext=function(){return this.ctx},se.ViewPort.prototype.getWidth=function(){return this.element.width/this._scale},se.ViewPort.prototype.getHeight=function(){return this.element.height/this._scale},se.ViewPort.prototype.setSize=function(t,e){this.element.width=t,this.element.height=e},se.ViewPort.prototype.updateSize=function(){this.resetPivot();var t=this.element,e=t.parentElement;this.setSize(e.offsetWidth,e.offsetHeight)},se.ViewPort.prototype.updatePivot=function(t){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this._scale,this._scale);var e=t.x-this.getWidth()/2,i=t.y-this.getHeight()/2;this.pivot.change(e,i),this.ctx.translate(-e,-i)},se.ViewPort.prototype.clearframe=function(){this.ctx.clearRect(this.pivot.position.x,this.pivot.position.y,this.getWidth(),this.getHeight())},se.ViewPort.prototype.render=function(t){this.updatePivot(t.getCamera().transform.position),this.clearframe(),t.zoomCamera=this.scale(),this.renderBackground(t),t.render(this.ctx)},se.ViewPort.prototype.resetPivot=function(){this.pivot.change(0,0)},se.ViewPort.prototype.renderBackground=function(t){t.renderer.render(this.ctx,{x:this.pivot.position.x,y:this.pivot.position.y,width:this.getWidth(),height:this.getHeight()})},se.ViewPort.prototype.addInteraction=function(t){this.interactions.push(t),t.setParent(this)},se.ViewPort.prototype.removeInteraction=function(t){var e=this.interactions.indexOf(t);e!==-1&&(this.interactions.splice(e,1),t.desactive())},se.ViewPort.prototype.desactiveInteractions=function(){for(var t=0;t<this.interactions.length;t++)this.interactions[t].desactive()},se.ViewPort.prototype.activeInteractions=function(){for(var t=0;t<this.interactions.length;t++)this.interactions[t].active()},se.ViewPort.prototype.scale=function(t){return arguments.length&&(t=parseFloat(t,1)||1,t>0&&(this._scale=t)),this._scale},se.ViewPort.prototype.transformPixelToCoordinate=function(t,e){var i=new se.Point(t,e),n=new se.Point(this._scale,this._scale);return i.div(n,!0),i.add(this.pivot.position,!0)},se.ViewPort.prototype.getExtent=function(){return new se.Extent(this.pivot.position.x,this.pivot.position.y,this.getWidth()+this.pivot.position.x,this.getHeight()+this.pivot.position.y)},se.ViewPort.prototype.getCenter=function(){return this.getExtent().getCenter()},se.ComponentFollowObject=function(t){se.Component.call(this),this.objTarget=t},se.inherit(se.Component,se.ComponentFollowObject),se.ComponentFollowObject.prototype.update=function(t){t.transform.position.x=this.objTarget.transform.position.x,t.transform.position.y=this.objTarget.transform.position.y},se.ComponentPlatformPlayerController=function(t,e,i){se.Component.call(this),this.joystick=t,this.speed=e||.5,this.jumpspeed=i||-13},se.inherit(se.Component,se.ComponentPlatformPlayerController),se.ComponentPlatformPlayerController.prototype.update=function(t,e){var i=this.joystick.getAxis("horizontal")*e/10;i=i||0;var n=this.joystick.getAxis("jump");if(i||n){var o=t.rigidbody.body.velocity;i=o.x+i*this.speed;var s=o.y;i>0?t.transform.rotate.x=1:i<0&&(t.transform.rotate.x=-1),i>16&&(i=16),i<-16&&(i=-16),n&&o.y<1&&o.y>-1&&(s=this.jumpspeed),t.rigidbody.setVelocity({x:i,y:s})}},se.ComponentScript=function(t,e){se.Component.call(this),this.update=t||function(){},this.resolveCollision=e},se.inherit(se.Component,se.ComponentScript),se.FreeController=function(t,e){se.Component.call(this),this.joystick=t,this.speed=e||1},se.inherit(se.Component,se.FreeController),se.FreeController.prototype.update=function(){var t=this.joystick.getAxis("horizontal")||0,e=this.joystick.getAxis("vertical")||0;t&&(t*=this.speed),e&&(e*=this.speed),this.parent.transform.move(t,e)},se.DrawInteraction=function(t){se.Interaction.call(this),this.target=t;var e=this;this.last=null,this.click=function(t){return!e.target||t.detail>1?null:void(e.last&&e.point.equals(e.last)||(e.last=e.point,e.point=e.point.clone(),e.target.mesh.addVertice(e.point)))},this.end=function(){return e.target?(e.target.mesh.vertices.pop(),void e.finish()):null},this.mousemove=function(t){e.move(t.offsetX,t.offsetY)},this.touchmove=function(t){if(1===t.touches.length){var i=t.touches[0];e.move(i.pageX,i.pageY)}}},se.inherit(se.Interaction,se.DrawInteraction),se.drawStartEvent=new Event("seDrawStart"),se.drawEndEvent=new Event("seDrawEnd"),se.DrawInteraction.prototype.active=function(){var t=this.parent.element;this.point=new se.Point(0,0),this.target&&this.target.mesh.addVertice(this.point),t.addEventListener("click",this.click),t.addEventListener("dblclick",this.end),t.addEventListener("mousemove",this.mousemove),t.addEventListener("touchmove",this.touchmove)},se.DrawInteraction.prototype.desactive=function(){var t=this.parent.element;t.removeEventListener("click",this.click),t.removeEventListener("dblclick",this.end),t.removeEventListener("mousemove",this.mousemove),t.removeEventListener("touchmove",this.touchmove)},se.DrawInteraction.prototype.move=function(t,e){if(!this.target)return null;var i=this.parent.transformPixelToCoordinate(t,e);this.point.change(i.x,i.y)},se.DrawInteraction.prototype.finish=function(){this.updateCenter(),document.dispatchEvent(se.drawEndEvent),this.target=null},se.DrawInteraction.prototype.updateCenter=function(){for(var t=this.target.mesh.getExtent().getCenter(),e=0;e<this.target.mesh.vertices.length;e++){var i=this.target.mesh.vertices[e];i.sub(t,!0)}this.target.transform.move(t.x,t.y)},se.PanInteraction=function(t){se.Interaction.call(this);var e=this;this.target=t,this.inverse=!0,this.mousedown=function(t){e.start(t.offsetX,t.offsetY)},this.mouseup=function(){e.end()},this.mousemove=function(t){e.move(t.offsetX,t.offsetY)},this.touchstart=function(t){if(1===t.touches.length){var i=t.touches[0];e.start(i.pageX,i.pageY)}},this.touchend=function(){e.end()},this.touchmove=function(t){if(1===t.touches.length){var i=t.touches[0];e.move(i.pageX,i.pageY)}}},se.inherit(se.Interaction,se.PanInteraction),se.panEndEvent=new Event("sePanEnd"),se.PanInteraction.prototype.active=function(){this.isDown=!1,this.last=null;var t=this.parent.element;t.addEventListener("mousedown",this.mousedown),t.addEventListener("mouseup",this.mouseup),t.addEventListener("mousemove",this.mousemove),t.addEventListener("touchstart",this.touchstart),t.addEventListener("touchend",this.touchend),t.addEventListener("touchmove",this.touchmove)},se.PanInteraction.prototype.desactive=function(){var t=this.parent.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("mouseup",this.mouseup),t.removeEventListener("mousemove",this.mousemove),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchend",this.touchend)},se.PanInteraction.prototype.start=function(t,e){this.last=new se.Point(t,e),this.isDown=!0},se.PanInteraction.prototype.end=function(){this.isDown=!1,document.dispatchEvent(se.panEndEvent)},se.PanInteraction.prototype.move=function(t,e){var i=this.parent;if(this.isDown){var n=new se.Point(t,e),o=n.sub(this.last);this.inverse&&o.neg(!0);var s=i.scale();o.div({x:s,y:s},!0),this.target.transform.move(o.x,o.y),this.last=n}},se.ZoomInteraction=function(){se.Interaction.call(this);var t=this;this.wheel=function(e){var i=t.parent,n=.05;e.deltaY>0&&(n*=-1);var o=i.scale()+n;i.scale(o)},this.touchstart=function(e){if(2===e.touches.length){var i=t.parseTouchToVector(e.touches[0]),n=t.parseTouchToVector(e.touches[1]);t._distance=i.calcDistance(n)}},this.touchmove=function(e){if(2===e.touches.length){var i=t.parent,n=t.parseTouchToVector(e.touches[0]),o=t.parseTouchToVector(e.touches[1]),s=n.calcDistance(o),r=0;void 0!==t._distance&&(r=2*(s-t._distance)/1e3),t._distance=s;var a=i.scale()+r;i.scale(a)}}},se.inherit(se.Interaction,se.ZoomInteraction),se.ZoomInteraction.prototype.active=function(){var t=this.parent.element;t.addEventListener("wheel",this.wheel),t.addEventListener("touchstart",this.touchstart),t.addEventListener("touchmove",this.touchmove)},se.ZoomInteraction.prototype.desactive=function(){var t=this.parent.element;t.removeEventListener("wheel",this.wheel),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove)},se.CircleRenderer=function(t,e,i,n){se.Renderer.call(this),this.radius=t,this.fillStyle=e,this.strokeStyle=i,this.lineWidth=n||1},se.inherit(se.Renderer,se.CircleRenderer),se.CircleRenderer.prototype.render=function(t){t.beginPath(),t.fillStyle=this.fillStyle,this.strokeStyle&&(t.strokeStyle=this.strokeStyle,t.lineWidth=this.lineWidth),t.arc(0,0,this.radius,0,2*Math.PI),t.fill(),this.strokeStyle&&t.stroke()},se.CircleRenderer.prototype.json=function(){
return{type:"CircleRenderer",radius:this.radius,fillStyle:this.fillStyle,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth}},se.EditRenderer=function(t,e,i,n){se.Renderer.call(this),this.color=t,this.strokeStyle=e,this.lineWidth=i,this.pointColor=n},se.inherit(se.Renderer,se.EditRenderer),se.EditRenderer.prototype.render=function(t){var e=this.parent.mesh,i=t;e.vertices.length&&(this.renderMesh(i),this.renderPoints(i)),this.renderPosition(i)},se.EditRenderer.prototype.renderPosition=function(t){t.beginPath();var e=this.parent.transform.position;t.fillStyle="red",t.arc(e.x,e.y,4,0,2*Math.PI),t.fill()},se.EditRenderer.prototype.renderMesh=function(t){var e=this.parent.mesh;t.beginPath(),t.moveTo(e.vertices[0].x,e.vertices[0]);for(var i=1;i<e.vertices.length;i++)t.lineTo(e.vertices[i].x,e.vertices[i].y);t.lineTo(e.vertices[0].x,e.vertices[0].y),t.closePath(),t.fillStyle=this.color,this.strokeStyle&&(t.lineWidth=this.lineWidth,t.strokeStyle=this.strokeStyle,t.stroke()),t.fill()},se.EditRenderer.prototype.renderPoints=function(t){var e=this.parent.mesh;t.fillStyle=this.pointColor,t.strokeStyle="white",t.lineWidth=1;for(var i=0;i<e.vertices.length;i++)t.beginPath(),t.arc(e.vertices[i].x,e.vertices[i].y,3,0,2*Math.PI),t.fill(),t.stroke()},se.EditRenderer.prototype.json=function(){return{type:"EditRenderer",fillColor:this.color,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth,pointColor:this.pointColor}},se.GradientRenderer=function(t,e){se.Renderer.call(this),this.color1=t||"#004CB3",this.color2=e||"#8ED6FF"},se.inherit(se.Renderer,se.GradientRenderer),se.GradientRenderer.prototype.setParent=function(t){this.parent=t},se.GradientRenderer.prototype.render=function(t,e){var i=t.createLinearGradient(150,0,150,300);i.addColorStop(0,this.color1),i.addColorStop(1,this.color2),t.fillStyle=i,t.fillRect(e.x,e.y,e.width,e.height)},se.GradientRenderer.prototype.json=function(){return{type:"GradientRenderer",color1:this.color1,color2:this.color2}},se.ImageRenderer=function(t,e,i){se.Renderer.call(this),this.img=new Image,this.img.src=t,this.width=e,this.height=i},se.inherit(se.Renderer,se.ImageRenderer),se.ImageRenderer.prototype.render=function(t){t.drawImage(this.img,-this.width/2,-this.height/2,this.width,this.height)},se.ImageRenderer.prototype.json=function(){return{type:"ImageRenderer",imageSrc:this.img.src,width:this.width,height:this.height}},se.MeshRenderer=function(t,e,i){se.Renderer.call(this),this.color=t,this.strokeStyle=e,this.lineWidth=i},se.inherit(se.Renderer,se.MeshRenderer),se.MeshRenderer.prototype.render=function(t){var e=this.parent.mesh,i=t;if(e.vertices.length){i.beginPath(),i.moveTo(e.vertices[0].x,e.vertices[0]);for(var n=1;n<e.vertices.length;n++)i.lineTo(e.vertices[n].x,e.vertices[n].y);i.lineTo(e.vertices[0].x,e.vertices[0].y),i.closePath(),i.fillStyle=this.color,this.strokeStyle&&(i.lineWidth=this.lineWidth,i.strokeStyle=this.strokeStyle,i.stroke()),i.fill()}},se.MeshRenderer.prototype.json=function(){return{type:"MeshRenderer",fillColor:this.color,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth}},se.RectRenderer=function(t,e,i){se.Renderer.call(this),this.color=t,this.width=e,this.height=i},se.inherit(se.Renderer,se.RectRenderer),se.RectRenderer.prototype.render=function(t){t.fillStyle=this.color,t.fillRect(-this.width/2,-this.height/2,this.width,this.height)},se.RectRenderer.prototype.json=function(){return{type:"RectRenderer",color:this.color,width:this.width,height:this.height}};