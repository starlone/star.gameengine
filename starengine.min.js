var se={};window.animationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}();se.windowGameMain=null;se.updateFrame=function(){se.windowGameMain.update();animationFrame(se.updateFrame)};se.WindowGame=function(a){var b=this;this.element=document.getElementById(a);this.element.getContext&&(this.ctx=canvas.getContext("2d"));this.lastTime=Date.now();this.scenes=[];this.joystick=new se.Joystick;b.updateSize();window.addEventListener("resize",function(){b.getSceneCurrent().resetCamera();b.updateSize()})};se.WindowGame.prototype.getWidth=function(){return this.element.width};se.WindowGame.prototype.getHeight=function(){return this.element.height};
se.WindowGame.prototype.getSceneCurrent=function(){return this.scenes[0]};se.WindowGame.prototype.setSize=function(a,b){this.element.width=a;this.element.height=b};se.WindowGame.prototype.updateSize=function(){var a=this.element.parentElement;this.setSize(a.offsetWidth,a.offsetHeight)};se.WindowGame.prototype.getContext=function(){return this.ctx};se.WindowGame.prototype.addScene=function(a){this.scenes.push(a);a.setParent(this)};
se.WindowGame.prototype.update=function(){var a=Date.now(),b=(a-this.lastTime)/1E3,c=this.getSceneCurrent();c.update(b);c.render(this.ctx);this.lastTime=a};se.WindowGame.prototype.init=function(){se.windowGameMain=this;animationFrame(se.updateFrame)};se.GameObject=function(a,b,c,d,e){this.name=a;this.transform=new se.Transform(this,b,c);this.width=d;this.height=e;this.components=[];this.colliders=[];this.parent=this.renderer=null;this.children=[]};se.GameObject.prototype.getX=function(){return this.transform.position.x};se.GameObject.prototype.getY=function(){return this.transform.position.y};se.GameObject.prototype.getWidth=function(){return this.width};se.GameObject.prototype.getHeight=function(){return this.height};
se.GameObject.prototype.getColliders=function(){return this.colliders};se.GameObject.prototype.setRenderer=function(a){a.setParent(this);this.renderer=a};se.GameObject.prototype.update=function(a){for(var b in this.components)this.components[b].update(this,a);for(b in this.children)this.children[b].update(a)};
se.GameObject.prototype.render=function(a){var b=this.transform.position,c=this.transform.rotate;a.translate(b.x,b.y);a.rotate(c.y*Math.PI/180);a.scale(c.x,1);this.renderer&&this.renderer.render(a);for(var d in this.children)this.children[d].render(a);a.scale(c.x,1);a.rotate(-c.y*Math.PI/180);a.translate(-b.x,-b.y)};se.GameObject.prototype.addComponent=function(a){this.components.push(a);a.setParent(this);return this};
se.GameObject.prototype.addCollider=function(a){this.colliders.push(a);a.setParent(this);return this};se.GameObject.prototype.setParent=function(a){this.parent=a};se.GameObject.prototype.addChild=function(a){this.children.push(a);a.setParent(this)};se.Position=function(a,b){this.x=a;this.y=b};se.Position.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};se.Position.prototype.clone=function(){return new se.Position(this.x,this.y)};se.Rotate=function(a,b){this.x=a;this.y=b};
se.Transform=function(a,b,c){this.parent=a;this.position=new se.Position(b,c);this.rotate=new se.Rotate(1,0)};se.Transform.prototype.change=function(a,b){this.position.x=a;this.position.y=b};se.Transform.prototype.move=function(a,b){this.canMove(a,b)&&(this.position.x+=a,this.position.y+=b)};se.Transform.prototype.canMove=function(a,b){var c=this.parent,d=c.parent.getObjs(),e=c.getColliders(),g;for(g in e){var f=e[g].clone();f.setParent(c);f.x+=a;f.y+=b;for(var h in d)if(f.isIntersect(d[h].getColliders()))return!1}return!0};
se.Transform.prototype.getXY=function(){var a=this.position.x,b=this.position.y,c=this.parent.parent;c instanceof se.GameObject&&(a+=c.transform.position.x,b+=c.transform.position.y);return{x:a,y:b}};se.BoxCollider=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};se.BoxCollider.prototype.setParent=function(a){this.parent=a};se.BoxCollider.prototype.getPoints=function(){var a=this.parent,b=a.getX()+this.x,a=a.getY()+this.y,c=this.width,d=this.height,e=[];e.push([b,a]);e.push([b+c,a]);e.push([b,a+d]);e.push([b+c,a+d]);return e};
se.BoxCollider.prototype.isIntersect=function(a){if(a instanceof Array)for(var b in a){if(this._isIntersect(a[b]))return!0}else return this._isIntersect(a);return!1};se.BoxCollider.prototype._isIntersect=function(a){var b=this.getPoints(),c=a.getPoints();a=c[0];var c=c[3],d;for(d in b)if(b[d][0]>a[0]&&b[d][0]<c[0]&&b[d][1]>a[1]&&b[d][1]<c[1])return!0;return!1};se.BoxCollider.prototype.clone=function(){return new se.BoxCollider(this.x,this.y,this.width,this.height)};se.Scene=function(a){this.camera=new se.GameObject("MainCamera",0,0,0,0);this.camera.setParent(this);this.pivot=this.camera.transform.position.clone();this.objs=[this.camera];this.backcolor="rgba(135, 206, 250,1)";a&&(this.backcolor=a)};se.Scene.prototype.getWidth=function(){return this.parent.getWidth()};se.Scene.prototype.getHeight=function(){return this.parent.getHeight()};se.Scene.prototype.getCamera=function(){return this.camera};se.Scene.prototype.getObjs=function(){return this.objs};
se.Scene.prototype.setParent=function(a){this.parent=a};se.Scene.prototype.add=function(a){this.objs.push(a);a.setParent(this)};se.Scene.prototype.update=function(a){for(var b in this.objs)this.objs[b].update(a)};se.Scene.prototype.render=function(a){this.updatePivot(a);this.clearframe(a);this.renderBackground(a);for(var b in this.objs)this.objs[b].render(a)};se.Scene.prototype.renderBackground=function(a){a.fillStyle=this.backcolor;a.fillRect(this.pivot.x,this.pivot.y,this.getWidth(),this.getHeight())};
se.Scene.prototype.clearframe=function(a){a.clearRect(this.pivot.x,this.pivot.y,this.getWidth(),this.getHeight())};se.Scene.prototype.updatePivot=function(a){a.setTransform(1,0,0,1,0,0);var b=this.camera.transform.position,c=b.x-this.getWidth()/2,b=b.y-this.getHeight()/2;this.pivot.x=c;this.pivot.y=b;a.translate(-this.pivot.x,-this.pivot.y)};se.Scene.prototype.resetCamera=function(){this.lastPosition=new se.Position(0,0)};se.BoxRenderer=function(a){this.color=a};se.BoxRenderer.prototype.render=function(a){var b=this.parent;a.fillStyle=this.color;a.fillRect(0,0,b.width,b.height)};se.BoxRenderer.prototype.setParent=function(a){this.parent=a};se.ComponentScript=function(a){this.update=a};se.ComponentScript.prototype.setParent=function(a){this.parent=a};se.ComponentPlatformPlayerController=function(a,b,c,d){this.joystick=a;this.speed=b;this.gravity=d;this.jumpspeed=c;this.jumptime=0;this.jumptimeend=25;this.isjump=!1;this.maxH=200};
se.ComponentPlatformPlayerController.prototype.update=function(a,b){this.deltaTime=b;var c=this.joystick.getAxis("horizontal")*this.speed*b;c&&(a.transform.move(c,0),0<c?a.transform.rotate.x=1:0>c&&(a.transform.rotate.x=-1));c=a.transform.getXY().y;this.isjump?c>this.jumptimeend?a.transform.move(0,-1*this.jumpspeed*b):this.isjump=!1:this.isgrounded()?this.joystick.getAxis("jump")&&(this.isjump=!0,this.jumptimeend=c-this.maxH,a.transform.move(0,-1*this.jumpspeed*b)):a.transform.move(0,this.gravity*
b)};se.ComponentPlatformPlayerController.prototype.isgrounded=function(){return!this.parent.transform.canMove(0,this.gravity*this.deltaTime)};se.ComponentPlatformPlayerController.prototype.setParent=function(a){this.parent=a};se.ComponentFollowPlayer=function(a){this.obj_player=a};se.ComponentFollowPlayer.prototype.update=function(a){a.transform.position.x=this.obj_player.transform.position.x;a.transform.position.y=this.obj_player.transform.position.y};
se.ComponentFollowPlayer.prototype.setParent=function(a){this.parent=a};se.ComponentRigidBody=function(a){this.gravity=a};se.ComponentRigidBody.prototype.update=function(a,b){a.transform.move(0,this.gravity*b)};se.ComponentRigidBody.prototype.setParent=function(a){this.parent=a};se.Joystick=function(){this.jump=!1;this.keyhandler=new se.KeyboardHandler(this)};se.Joystick.prototype.getAxis=function(a){return"horizontal"==a?this.x:"vertical"==a?this.y:"jump"==a?this.jump:0};se.Joystick.prototype.setAxis=function(a,b){"horizontal"==a&&(this.x=b);"vertical"==a&&(this.y=b);"jump"==a&&(this.jump=b)};se.Joystick.prototype.resetAxis=function(){this.y=this.x=0;this.jump=!1};
se.KeyboardHandler=function(a){var b=this;this.joy=a;document.addEventListener("keydown",function(a){b.keydown(a.keyCode)});document.addEventListener("keyup",function(a){b.keyup(a.keyCode)})};se.KeyboardHandler.prototype.keydown=function(a){"65"==a||"37"==a?this.joy.setAxis("horizontal",-1):"68"==a||"39"==a?this.joy.setAxis("horizontal",1):"87"==a?this.joy.setAxis("vertical",-1):"83"==a?this.joy.setAxis("vertical",1):"32"==a&&this.joy.setAxis("jump",!0)};
se.KeyboardHandler.prototype.keyup=function(a){"65"==a||"68"==a||"37"==a||"39"==a?this.joy.setAxis("horizontal",0):"87"==a||"83"==a?this.joy.setAxis("vertical",0):"32"==a&&this.joy.setAxis("jump",!1)};
