var se={};"undefined"!=typeof window&&(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(function(){e(Date.now())},1e3/60)}}(),window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame),se.inherit=function(e,t){var i=Object.create(e.prototype);t.prototype=i,t.prototype.constructor=t},se.RectCollider=function(e){e=e||{},this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this.id=null,this.isStatic=!1,void 0!==e.isStatic&&(this.isStatic=e.isStatic)},se.RectCollider.createByExtent=function(e){return new se.RectCollider(e.min.x,e.min.y,e.max.x,e.max.y)},se.RectCollider.prototype.setParent=function(e){if(this.parent=e,void 0===this.width){var t=e.mesh.getExtent();this.x=t.min.x,this.y=t.min.y,this.width=t.max.x,this.height=t.max.y}},se.RectCollider.prototype.getExtent=function(){var e=this.parent,t=e.transform.getRealPosition();return new se.Extent(t.x,t.y,t.x+this.width,t.y+this.height)},se.RectCollider.prototype.isIntersect=function(e){var t=this.getExtent(),i=e.getExtent();return t.intersects(i)},se.RectCollider.prototype.getIntersection=function(e){if(!(e instanceof Array))return this._getIntersection(e);for(var t=0;t<e.length;t++){var i=e[t];if(this._isIntersect(i))return this._getIntersection(i)}return null},se.RectCollider.prototype._getIntersection=function(e){var t=this.getExtent(),i=e.getExtent();return t.getIntersection(i)},se.RectCollider.prototype.resolveCollision=function(e){this.parent.resolveCollision(e)},se.RectCollider.prototype.setStatic=function(e){this.isStatic=e},se.RectCollider.prototype.clone=function(){return new se.RectCollider(this.x,this.y,this.width,this.height)},se.Component=function(){},se.Component.prototype.update=function(){},se.Component.prototype.resolveCollision=function(){},se.Component.prototype.setParent=function(e){this.parent=e},se.Extent=function(e,t,i,n){this.min={x:e,y:t},this.max={x:i,y:n}},se.Extent.createEmpty=function(){return new se.Extent(1/0,1/0,(-(1/0)),(-(1/0)))},se.Extent.prototype.clone=function(){return new se.Extent(this.min.x,this.min.y,this.max.x,this.max.y)},se.Extent.prototype.move=function(e){return this.min.x+=e.x,this.min.y+=e.y,this.max.x+=e.x,this.max.y+=e.y,this},se.Extent.prototype.extend=function(e){return e.min.x<this.min.x&&(this.min.x=e.min.x),e.max.x>this.max.x&&(this.max.x=e.max.x),e.min.y<this.min.y&&(this.min.y=e.min.y),e.max.y>this.max.y&&(this.max.y=e.max.y),this},se.Extent.prototype.extendVector=function(e){return e.x<this.min.x&&(this.min.x=e.x),e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y&&(this.min.y=e.y),e.y>this.max.y&&(this.max.y=e.y),this},se.Extent.prototype.extendVectors=function(e){for(var t=0;t<e.length;t++)this.extendVector(e[t]);return this},se.Extent.prototype.intersects=function(e){return this.min.x<=e.max.x&&this.max.x>=e.min.x&&this.min.y<=e.max.y&&this.max.y>=e.min.y},se.Extent.prototype.getIntersection=function(e){var t=se.Extent.createEmpty();return this.intersects(e)?(this.min.x>e.min.x?t.min.x=this.min.x:t.min.x=e.min.x,this.min.y>e.min.y?t.min.y=this.min.y:t.min.y=e.min.y,this.max.x<e.max.x?t.max.x=this.max.x:t.max.x=e.max.x,this.max.y<e.max.y?t.max.y=this.max.y:t.max.y=e.max.y,t):null},se.Extent.prototype.getWidth=function(){return this.max.x-this.min.x},se.Extent.prototype.getHeight=function(){return this.max.y-this.min.y},se.Extent.prototype.containsXY=function(e,t){return this.min.x<=e&&e<=this.max.x&&this.min.y<=t&&t<=this.max.y},se.factory={},se.factory.rect=function(e){var t=e||{},i=t.name||"",n=t.x||0,o=t.y||0,s=t.w||10,r=t.h||10,a=t.image_src,h=t.fillColor||"#6B4226",c=t.rigidopts||{};void 0===t.hasRigidbody&&(t.hasRigidbody=!0);var d=[new se.Point(0,0),new se.Point(s,0),new se.Point(s,r),new se.Point(0,r)],l=new se.GameObject(i,n,o,{vertices:d});return t.hasRigidbody&&l.setRigidBody(new se.RigidBody(c)),a?l.setRenderer(new se.ImageRenderer(a,s,r)):l.setRenderer(new se.RectRenderer(h,s,r)),l},se.factory.circle=function(e){var t=e||{},i=t.name||"",n=t.x||0,o=t.y||0,s=t.radius||10,r=t.rigidopts||{},a=t.maxSides||25;void 0===t.hasRigidbody&&(t.hasRigidbody=!0);var h=t.fillColor,c=t.strokeColor,d=t.lineWidth,l=se.factory.createCircleVertices(s,a);l=se.load.points(l);var p=new se.GameObject(i,n,o,{vertices:l});return t.hasRigidbody&&p.setRigidBody(new se.RigidBody(r)),p.setRenderer(new se.CircleRenderer(s,h,c,d)),p},se.factory.createCircleVertices=function(e,t){t=t||25;var i=Math.ceil(Math.max(10,Math.min(t,e)));i%2===1&&(i+=1);for(var n=2*Math.PI/i,o="",s=.5*n,r=0;r<i;r++){var a=s+r*n,h=Math.cos(a)*e,c=Math.sin(a)*e;o+="L "+h.toFixed(3)+" "+c.toFixed(3)+" "}return Matter.Vertices.fromPath(o)},se.GameObject=function(e,t,i,n){this.name=e,this.transform=new se.Transform(this,t,i),this.components=[],this.colliders=[],this.renderer=null,this.parent=null,this.children=[],n=n||{};var o=n.vertices||[];this.setMesh(new se.Mesh(o)),this.rigidbody=n.rigidbody||null,this.angle=n.angle||0},se.GameObject.prototype.getX=function(){return this.transform.position.x},se.GameObject.prototype.getY=function(){return this.transform.position.y},se.GameObject.prototype.getWidth=function(){return this.width},se.GameObject.prototype.getHeight=function(){return this.height},se.GameObject.prototype.getScene=function(){for(var e=this.parent;null!==e&&e instanceof se.Scene==!1;)e=e.parent;return e},se.GameObject.prototype.getColliders=function(){return this.colliders},se.GameObject.prototype.setRenderer=function(e){e.setParent(this),this.renderer=e},se.GameObject.prototype.getRenderer=function(){return this.renderer},se.GameObject.prototype.update=function(e,t){var i=this.rigidbody;i&&this.rigidbody.update(e,t);for(var n=0;n<this.components.length;n++)this.components[n].update(this,e,t);for(var o=0;o<this.children.length;o++)this.children[o].update(e,t)},se.GameObject.prototype.resolveCollision=function(e){for(var t=0;t<this.components.length;t++){var i=this.components[t];i.resolveCollision&&i.resolveCollision(e)}},se.GameObject.prototype.render=function(e){var t=this,i=t.transform.position,n=t.transform.rotate;e.translate(i.x,i.y),e.rotate(t.angle),e.scale(n.x,1),this.renderer&&this.renderer.render(e);for(var o=0;o<this.children.length;o++)this.children[o].render(e);e.scale(n.x,1),e.rotate(-t.angle),e.translate(-i.x,-i.y)},se.GameObject.prototype.addComponent=function(e){return this.components.push(e),e.setParent(this),this},se.GameObject.prototype.addCollider=function(e){return this.colliders.push(e),e.setParent(this),this},se.GameObject.prototype.setRigidBody=function(e){return this.rigidbody=e,e.setParent(this),this},se.GameObject.prototype.setParent=function(e){this.parent=e},se.GameObject.prototype.addChild=function(e){this.children.push(e),e.setParent(this)},se.GameObject.prototype.removeChild=function(e){this.children.remove(e)},se.GameObject.prototype.destroy=function(){this.parent instanceof se.GameObject?this.parent.removeChild(this):this.getScene().remove(this),delete this},se.GameObject.prototype.setMesh=function(e){this.mesh=e,e.setParent(this)},se.GameObject.prototype.clone=function(){var e={vertices:this.mesh.vertices,angle:this.angle},t=this.transform.position.x,i=this.transform.position.y,n=new this.constructor(this.name,t,i,e);if(this.rigidbody){var o=this.rigidbody.body,s={isStatic:o.isStatic,canRotate:o.canRotate};n.setRigidBody(new se.RigidBody(s))}if(this.renderer){var r=this.renderer.clone();n.setRenderer(r)}return n},se.GameObject.prototype.json=function(){var e=null;this.rigidbody&&(e=this.rigidbody.json());var t=null;return this.renderer&&(t=this.renderer.json()),{type:"GameObject",name:this.name,angle:this.angle,transform:this.transform.json(),mesh:this.mesh.json(),rigidbody:e,renderer:t}},se.Transform=function(e,t,i){this.parent=e,this.position=new se.Point(t,i),this.rotate=new se.Point(1,0)},se.Transform.prototype.change=function(e,t){var i=this.parent.rigidbody;i?i.setPosition({x:e,y:t}):this.position.change(e,t)},se.Transform.prototype.move=function(e,t){this.position.x+=e,this.position.y+=t},se.Transform.prototype.getRealPosition=function(){var e=this.position.x,t=this.position.y,i=this.parent,n=i.parent;return n instanceof se.GameObject&&(e+=n.transform.position.x,t+=n.transform.position.y),{x:e,y:t}},se.Transform.prototype.json=function(){return{type:"Transform",position:this.position.json(),rotate:this.rotate.json()}},se.Interaction=function(){},se.Interaction.prototype.active=function(){},se.Interaction.prototype.desactive=function(){},se.Interaction.prototype.setParent=function(e){this.parent=e,this.active()},se.Interaction.prototype.parseTouchToVector=function(e){return new se.Point(e.pageX,e.pageY)},se.Joystick=function(){this.x=0,this.y=0,this.jump=!1,this.keyhandler=new se.KeyboardHandler(this)},se.Joystick.prototype.getAxis=function(e){return"horizontal"===e?this.x:"vertical"===e?this.y:"jump"===e?this.jump:0},se.Joystick.prototype.setAxis=function(e,t){"horizontal"===e&&(this.x=t),"vertical"===e&&(this.y=t),"jump"===e&&(this.jump=t)},se.Joystick.prototype.resetAxis=function(){this.x=0,this.y=0,this.jump=!1},se.KeyboardHandler=function(e){var t=this;this.joy=e,document.addEventListener("keydown",function(e){var i=parseInt(e.keyCode,0);t.keydown(i)}),document.addEventListener("keyup",function(e){var i=parseInt(e.keyCode,0);t.keyup(i)})},se.KeyboardHandler.prototype.keydown=function(e){65===e||37===e?this.joy.setAxis("horizontal",-1):68===e||39===e?this.joy.setAxis("horizontal",1):87===e||38===e?this.joy.setAxis("vertical",-1):83===e||40===e?this.joy.setAxis("vertical",1):32===e&&this.joy.setAxis("jump",!0)},se.KeyboardHandler.prototype.keyup=function(e){65===e||68===e||37===e||39===e?this.joy.setAxis("horizontal",0):87===e||83===e||38===e||40===e?this.joy.setAxis("vertical",0):32===e&&this.joy.setAxis("jump",!1)},se.load={},se.load.scene=function(e){var t=null;e.renderer&&(t=se.load.renderer(e.renderer));for(var i=new se.Scene(t),n=0;n<e.objs.length;n++){var o=e.objs[n],s=se.load.gameobject(o);i.add(s)}return i},se.load.gameobject=function(e){var t=se.load.points(e.mesh.vertices),i={angle:e.angle,vertices:t},n=e.transform.position,o=new se.GameObject(e.name,n.x,n.y,i);if(e.rigidbody&&o.setRigidBody(new se.RigidBody(e.rigidbody)),e.renderer){var s=se.load.renderer(e.renderer);o.setRenderer(s)}return o},se.load.point=function(e){return new se.Point(e.x,e.y)},se.load.points=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],o=se.load.point(n);t.push(o)}return t},se.load.renderer=function(e){var t=null;return"CircleRenderer"===e.type?t=new se.CircleRenderer(e.radius,e.fillStyle,e.strokeStyle,e.lineWidth):"RectRenderer"===e.type?t=new se.RectRenderer(e.color,e.width,e.height):"MeshRenderer"===e.type?t=new se.MeshRenderer(e.fillColor,e.strokeStyle,e.lineWidth):"ImageRenderer"===e.type?t=new se.ImageRenderer(e.imageSrc,e.width,e.height):"GradientRenderer"===e.type&&(t=new se.GradientRenderer(e.color1,e.color2)),t},se.Mesh=function(e){this.vertices=e||[];var t=Matter.Vertices.centre(e);Matter.Vertices.translate(e,t,-1)},se.Mesh.prototype.setVertices=function(e){this.vertices=e},se.Mesh.prototype.getVertices=function(){return this.vertices},se.Mesh.prototype.addVertice=function(e){this.vertices.push(e)},se.Mesh.prototype.getExtent=function(){var e=this.parent.transform.getRealPosition(),t=se.Extent.createEmpty();return t.extendVectors(this.vertices),t.move(e)},se.Mesh.prototype.setParent=function(e){this.parent=e},se.Mesh.prototype.json=function(){for(var e=[],t=0;t<this.vertices.length;t++)e.push(this.vertices[t].json());return{type:"Mesh",vertices:e}},se.Point=function(e,t){this.x=e,this.y=t},se.Point.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},se.Point.prototype.clone=function(){return new se.Point(this.x,this.y)},se.Point.prototype.change=function(e,t){this.x=e,this.y=t},se.Point.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},se.Point.prototype.sub=function(e,t){var i=t?this:new se.Point(0,0);return i.x=this.x-e.x,i.y=this.y-e.y,i},se.Point.prototype.add=function(e,t){var i=t?this:new se.Point(0,0);return i.x=this.x+e.x,i.y=this.y+e.y,i},se.Point.prototype.div=function(e,t){var i=t?this:new se.Point(0,0);return i.x=this.x/e.x,i.y=this.y/e.y,i},se.Point.prototype.mul=function(e,t){var i=t?this:new se.Point(0,0);return i.x=this.x*e.x,i.y=this.y*e.y,i},se.Point.prototype.neg=function(e){var t=e?this:new se.Point(0,0);return t.x=this.x*-1,t.y=this.y*-1,t},se.Point.prototype.calcDistance=function(e){var t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)},se.Point.prototype.json=function(){return{type:"Point",x:this.x,y:this.y}},se.Renderer=function(){},se.Renderer.prototype.render=function(){},se.Renderer.prototype.setParent=function(e){this.parent=e},se.Renderer.prototype.clone=function(){var e=new this.constructor;for(var t in this)({}).hasOwnProperty.call(this,t)&&(e[t]=this[t]);return e},se.Renderer.prototype.json=function(){return{type:"Renderer"}},se.RigidBody=function(e){this.options=e||{}},se.RigidBody.prototype.createBody=function(){var e=this.parent,t=e.transform.position,i=this.options||{},n=i.x||t.x,o=i.y||t.y,s=i.name||e.name;void 0===i.canRotate&&(i.canRotate=!0),delete i.x,delete i.y;var r={label:s,position:{x:n,y:o},vertices:e.mesh.getVertices(),angle:e.angle};this.body=Matter.Body.create(Matter.Common.extend({},r,i))},se.RigidBody.prototype.update=function(){var e=this.parent.transform.position;e.x=this.body.position.x,e.y=this.body.position.y,this.parent.angle=this.body.angle},se.RigidBody.prototype.setParent=function(e){this.parent=e,this.createBody()},se.RigidBody.prototype.setVelocity=function(e){Matter.Sleeping.set(this.body,!1),Matter.Body.setVelocity(this.body,e)},se.RigidBody.prototype.applyForce=function(e,t){Matter.Body.applyForce(this.body,e,t)},se.RigidBody.prototype.setAngularVelocity=function(e){Matter.Body.setAngularVelocity(this.body,e)},se.RigidBody.prototype.setPosition=function(e){Matter.Body.setPosition(this.body,e)},se.RigidBody.prototype.json=function(){return{isStatic:this.body.isStatic,canRotate:this.body.canRotate}},Matter.Body.update=function(e,t,i,n){var o=Matter.Bounds,s=Matter.Vector,r=Matter.Vertices,a=Matter.Axes,h=Math.pow(t*i*e.timeScale,2),c=1-e.frictionAir*i*e.timeScale,d=e.position.x-e.positionPrev.x,l=e.position.y-e.positionPrev.y;e.velocity.x=d*c*n+e.force.x/e.mass*h,e.velocity.y=l*c*n+e.force.y/e.mass*h,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.canRotate?e.angularVelocity=(e.angle-e.anglePrev)*c*n+e.torque/e.inertia*h:e.angularVelocity=0,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=s.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var p=0;p<e.parts.length;p++){var u=e.parts[p];r.translate(u.vertices,e.velocity),p>0&&(u.position.x+=e.velocity.x,u.position.y+=e.velocity.y),0!==e.angularVelocity&&(r.rotate(u.vertices,e.angularVelocity,e.position),a.rotate(u.axes,e.angularVelocity),p>0&&s.rotateAbout(u.position,e.angularVelocity,e.position,u.position)),o.update(u.bounds,u.vertices,e.velocity)}},se.Scene=function(e){this.camera=new se.GameObject("MainCamera",0,0,0,0),this.objs=[],this.colliders=[],this.add(this.camera),this.collisionsActive={},this.renderer=e||new se.GradientRenderer("#004CB3","#8ED6FF"),this.renderer.setParent(this),this.matterengine=Matter.Engine.create(),this.matterengine.enableSleeping=!0},se.Scene.prototype.getCamera=function(){return this.camera},se.Scene.prototype.getObjs=function(){return this.objs},se.Scene.prototype.setParent=function(e){this.parent=e},se.Scene.prototype.add=function(e){this.objs.push(e),e.setParent(this),e.rigidbody&&this.addBody(e.rigidbody.body),this.addColliders(e.getColliders())},se.Scene.prototype.remove=function(e){for(var t=e.getColliders(),i=0;i<t.length;i++){var n=t[i],o=this.colliders.indexOf(n);o!==-1&&this.colliders.splice(o,1)}e.rigidbody&&this.removeBody(e.rigidbody.body);var s=this.objs.indexOf(e);s!==-1&&this.objs.splice(s,1)},se.Scene.prototype.addBody=function(e){var t=this.matterengine;Matter.World.add(t.world,e)},se.Scene.prototype.removeBody=function(e){var t=this.matterengine;Matter.Composite.removeBody(t.world,e)},se.Scene.prototype.addColliders=function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addCollider(i)}},se.Scene.prototype.addCollider=function(e){this.colliders.push(e),e.id=this.colliders.length-1},se.Scene.prototype.update=function(e,t){Matter.Engine.update(this.matterengine,e,t),this.checkColliders();for(var i=0;i<this.objs.length;i++){var n=this.objs[i];n.update(e,t)}},se.Scene.prototype.checkColliders=function(){var e=this.collisionsActive;this.collisionsActive={};for(var t=[],i=0;i<this.colliders.length-1;i++)for(var n=this.colliders[i],o=i+1;o<this.colliders.length;o++){var s=this.colliders[o];if((!n.isStatic||!s.isStatic)&&n.isIntersect(s)){var r=n.id+"-"+s.id,a={a:n,b:s};this.collisionsActive[r]=a,void 0===e[r]&&t.push(a)}}for(var h=0;h<t.length;h++){var c=t[h];c.a.resolveCollision(c.b),c.b.resolveCollision(c.a)}},se.Scene.prototype.render=function(e){for(var t=0;t<this.objs.length;t++)this.objs[t].render(e)},se.Scene.prototype.clone=function(){for(var e=new se.Scene(this.renderer),t=this.getObjs(),i=0;i<t.length;i++){var n=t[i],o=n.clone();e.add(o)}return e},se.Scene.prototype.getObjectFromCoordinate=function(e){for(var t=this.getObjs(),i=t.length-1;i>=0;i--){var n=t[i];if(n.mesh.getExtent().containsXY(e.x,e.y))return n}},se.Scene.prototype.json=function(){for(var e=[],t=0;t<this.objs.length;t++)e.push(this.objs[t].json());return{type:"Scene",renderer:this.renderer.json(),objs:e}},se.StarEngine=function(e){this.element=e,this.scenes=[],this.joystick=new se.Joystick;var t={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0,timing:{timestamp:0,timeScale:1}},i=t;i.delta=i.delta||1e3/i.fps,i.deltaMin=i.deltaMin||1e3/i.fps,i.deltaMax=i.deltaMax||1e3/(.5*i.fps),i.fps=1e3/i.delta,this.runner=i},se.StarEngine.prototype.getSceneCurrent=function(){return this.scenes[0]},se.StarEngine.prototype.addScene=function(e){this.scenes.push(e),e.setParent(this)},se.StarEngine.prototype.update=function(e){var t,i=this.runner,n=i.timing,o=1;i.isFixed?t=i.delta:(t=e-i.timePrev||i.delta,i.timePrev=e,i.deltaHistory.push(t),i.deltaHistory=i.deltaHistory.slice(-i.deltaSampleSize),t=Math.min.apply(null,i.deltaHistory),t=t<i.deltaMin?i.deltaMin:t,t=t>i.deltaMax?i.deltaMax:t,o=t/i.delta,i.delta=t),0!==i.timeScalePrev&&(o*=n.timeScale/i.timeScalePrev),0===n.timeScale&&(o=0),i.timeScalePrev=n.timeScale,i.correction=o,i.frameCounter+=1,e-i.counterTimestamp>=1e3&&(i.fps=i.frameCounter*((e-i.counterTimestamp)/1e3),i.counterTimestamp=e,i.frameCounter=0)},se.StarEngine.prototype.run=function(){var e=this.runner,t=this;return this.viewport=this.viewport||null,!this.viewport&&this.element&&(this.viewport=new se.ViewPort(this.element)),function i(n){e.frameRequestId=window.requestAnimationFrame(i);var o=t.getSceneCurrent();n&&(t.update(n),e.enabled&&o.update(e.delta,e.correction)),t.viewport&&t.viewport.render(o)}(),e},se.StarEngine.prototype.pause=function(e){void 0===e&&(e=!0),this.runner.enabled=!e},se.ViewPort=function(e){var t=this;if(this.interactions=[],this._scale=1,e?"string"==typeof e?this.element=window.document.querySelector(e):this.element=e:this.element=window.document.body,"CANVAS"!==this.element.nodeName){var i=this.element;this.element=window.document.createElement("canvas"),i.appendChild(this.element)}this.pivot=new se.Transform(this,0,0),this.element.getContext&&(this.ctx=this.element.getContext("2d")),window.addEventListener("resize",function(){t.updateSize()}),t.updateSize()},se.ViewPort.prototype.getContext=function(){return this.ctx},se.ViewPort.prototype.getWidth=function(){return this.element.width/this._scale},se.ViewPort.prototype.getHeight=function(){return this.element.height/this._scale},se.ViewPort.prototype.setSize=function(e,t){this.element.width=e,this.element.height=t},se.ViewPort.prototype.updateSize=function(){this.resetPivot();var e=this.element,t=e.parentElement;this.setSize(t.offsetWidth,t.offsetHeight)},se.ViewPort.prototype.updatePivot=function(e){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this._scale,this._scale);var t=e.x-this.getWidth()/2,i=e.y-this.getHeight()/2;this.pivot.change(t,i),this.ctx.translate(-t,-i)},se.ViewPort.prototype.clearframe=function(){this.ctx.clearRect(this.pivot.position.x,this.pivot.position.y,this.getWidth(),this.getHeight())},se.ViewPort.prototype.render=function(e){this.updatePivot(e.getCamera().transform.position),this.clearframe(),this.renderBackground(e),e.render(this.ctx)},se.ViewPort.prototype.resetPivot=function(){this.pivot.change(0,0)},se.ViewPort.prototype.renderBackground=function(e){e.renderer.render(this.ctx,{x:this.pivot.position.x,y:this.pivot.position.y,width:this.getWidth(),height:this.getHeight()})},se.ViewPort.prototype.addInteraction=function(e){this.interactions.push(e),e.setParent(this)},se.ViewPort.prototype.removeInteraction=function(e){var t=this.interactions.indexOf(e);t!==-1&&(this.interactions.splice(t,1),e.desactive())},se.ViewPort.prototype.desactiveInteractions=function(){for(var e=0;e<this.interactions.length;e++)this.interactions[e].desactive()},se.ViewPort.prototype.activeInteractions=function(){for(var e=0;e<this.interactions.length;e++)this.interactions[e].active()},se.ViewPort.prototype.scale=function(e){return arguments.length&&(e=parseFloat(e,1)||1,e&&(this._scale=e)),this._scale},se.ViewPort.prototype.transformPixelToCoordinate=function(e,t){var i=new se.Point(e,t),n=new se.Point(this._scale,this._scale);return i.div(n,!0),i.add(this.pivot.position,!0)},se.ComponentFollowObject=function(e){se.Component.call(this),this.objTarget=e},se.inherit(se.Component,se.ComponentFollowObject),se.ComponentFollowObject.prototype.update=function(e){e.transform.position.x=this.objTarget.transform.position.x,e.transform.position.y=this.objTarget.transform.position.y},se.ComponentPlatformPlayerController=function(e,t,i){se.Component.call(this),this.joystick=e,this.speed=t||.5,this.jumpspeed=i||-13},se.inherit(se.Component,se.ComponentPlatformPlayerController),se.ComponentPlatformPlayerController.prototype.update=function(e,t){var i=this.joystick.getAxis("horizontal")*t/10;i=i||0;var n=this.joystick.getAxis("jump");if(i||n){var o=e.rigidbody.body.velocity;i=o.x+i*this.speed;var s=o.y;i>0?e.transform.rotate.x=1:i<0&&(e.transform.rotate.x=-1),i>16&&(i=16),i<-16&&(i=-16),n&&o.y<1&&o.y>-1&&(s=this.jumpspeed),e.rigidbody.setVelocity({x:i,y:s})}},se.ComponentScript=function(e,t){se.Component.call(this),this.update=e||function(){},this.resolveCollision=t},se.inherit(se.Component,se.ComponentScript),se.FreeController=function(e,t){se.Component.call(this),this.joystick=e,this.speed=t||1},se.inherit(se.Component,se.FreeController),se.FreeController.prototype.update=function(){var e=this.joystick.getAxis("horizontal")||0,t=this.joystick.getAxis("vertical")||0;e&&(e*=this.speed),t&&(t*=this.speed),this.parent.transform.move(e,t)},se.DrawInteraction=function(e){se.Interaction.call(this),this.target=e;var t=this;this.last=null,this.click=function(){return t.target?void(t.last&&t.point.equals(t.last)||(t.last=t.point,t.point=t.point.clone(),t.target.mesh.addVertice(t.point))):null},this.end=function(){return t.target?(t.target.mesh.vertices.pop(),document.dispatchEvent(se.drawEndEvent),void(t.target=null)):null},this.mousemove=function(e){t.move(e.offsetX,e.offsetY)},this.touchmove=function(e){if(1===e.touches.length){var i=e.touches[0];t.move(i.pageX,i.pageY)}}},se.inherit(se.Interaction,se.DrawInteraction),se.drawStartEvent=new Event("seDrawStart"),se.drawEndEvent=new Event("seDrawEnd"),se.DrawInteraction.prototype.active=function(){var e=this.parent.element;this.point=new se.Point(0,0),this.target&&this.target.mesh.addVertice(this.point),document.dispatchEvent(se.drawStartEvent),e.addEventListener("click",this.click),e.addEventListener("dblclick",this.end),e.addEventListener("mousemove",this.mousemove),e.addEventListener("touchmove",this.touchmove)},se.DrawInteraction.prototype.desactive=function(){var e=this.parent.element;e.removeEventListener("click",this.click),e.removeEventListener("dblclick",this.end),e.removeEventListener("mousemove",this.mousemove),e.removeEventListener("touchmove",this.touchmove)},se.DrawInteraction.prototype.move=function(e,t){if(!this.target)return null;var i=this.parent.transformPixelToCoordinate(e,t);this.point.change(i.x,i.y)},se.PanInteraction=function(e){se.Interaction.call(this);var t=this;this.target=e,this.inverse=!0,this.mousedown=function(e){t.start(e.offsetX,e.offsetY)},this.mouseup=function(){t.end()},this.mousemove=function(e){t.move(e.offsetX,e.offsetY)},this.touchstart=function(e){if(1===e.touches.length){var i=e.touches[0];t.start(i.pageX,i.pageY)}},this.touchend=function(){t.end()},this.touchmove=function(e){if(1===e.touches.length){var i=e.touches[0];t.move(i.pageX,i.pageY)}}},se.inherit(se.Interaction,se.PanInteraction),se.panEndEvent=new Event("sePanEnd"),se.PanInteraction.prototype.active=function(){this.isDown=!1,this.last=null;var e=this.parent.element;e.addEventListener("mousedown",this.mousedown),e.addEventListener("mouseup",this.mouseup),e.addEventListener("mousemove",this.mousemove),e.addEventListener("touchstart",this.touchstart),e.addEventListener("touchend",this.touchend),e.addEventListener("touchmove",this.touchmove)},se.PanInteraction.prototype.desactive=function(){var e=this.parent.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("mouseup",this.mouseup),e.removeEventListener("mousemove",this.mousemove),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchend",this.touchend)},se.PanInteraction.prototype.start=function(e,t){this.last=new se.Point(e,t),this.isDown=!0},se.PanInteraction.prototype.end=function(){this.isDown=!1,document.dispatchEvent(se.panEndEvent)},se.PanInteraction.prototype.move=function(e,t){var i=this.parent;if(this.isDown){var n=new se.Point(e,t),o=n.sub(this.last);this.inverse&&o.neg(!0);var s=i.scale();o.div({x:s,y:s},!0),this.target.transform.move(o.x,o.y),this.last=n}},se.ZoomInteraction=function(){se.Interaction.call(this);var e=this;this.wheel=function(t){var i=e.parent,n=.05;t.deltaY>0&&(n*=-1);var o=i.scale()+n;i.scale(o)},this.touchstart=function(t){if(2===t.touches.length){var i=e.parseTouchToVector(t.touches[0]),n=e.parseTouchToVector(t.touches[1]);e._distance=i.calcDistance(n)}},this.touchmove=function(t){if(2===t.touches.length){var i=e.parent,n=e.parseTouchToVector(t.touches[0]),o=e.parseTouchToVector(t.touches[1]),s=n.calcDistance(o),r=0;void 0!==e._distance&&(r=2*(s-e._distance)/1e3),e._distance=s;var a=i.scale()+r;i.scale(a)}}},se.inherit(se.Interaction,se.ZoomInteraction),se.ZoomInteraction.prototype.active=function(){var e=this.parent.element;e.addEventListener("wheel",this.wheel),e.addEventListener("touchstart",this.touchstart),e.addEventListener("touchmove",this.touchmove)},se.ZoomInteraction.prototype.desactive=function(){var e=this.parent.element;e.removeEventListener("wheel",this.wheel),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove)},se.CircleRenderer=function(e,t,i,n){se.Renderer.call(this),this.radius=e,this.fillStyle=t,this.strokeStyle=i,this.lineWidth=n||1},se.inherit(se.Renderer,se.CircleRenderer),se.CircleRenderer.prototype.render=function(e){e.beginPath(),e.fillStyle=this.fillStyle,this.strokeStyle&&(e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth),e.arc(0,0,this.radius,0,2*Math.PI),e.fill(),this.strokeStyle&&e.stroke()},se.CircleRenderer.prototype.json=function(){return{type:"CircleRenderer",radius:this.radius,fillStyle:this.fillStyle,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth}},se.EditRenderer=function(e,t,i,n){se.Renderer.call(this),this.color=e,this.strokeStyle=t,this.lineWidth=i,this.pointColor=n},se.inherit(se.Renderer,se.EditRenderer),se.EditRenderer.prototype.render=function(e){var t=this.parent.mesh,i=e;t.vertices.length&&(this.renderMesh(i),this.renderPoints(i)),this.renderPosition(i)},se.EditRenderer.prototype.renderPosition=function(e){e.beginPath();var t=this.parent.transform.position;e.fillStyle="red",e.arc(t.x,t.y,4,0,2*Math.PI),e.fill()},se.EditRenderer.prototype.renderMesh=function(e){var t=this.parent.mesh;e.beginPath(),e.moveTo(t.vertices[0].x,t.vertices[0]);for(var i=1;i<t.vertices.length;i++)e.lineTo(t.vertices[i].x,t.vertices[i].y);e.lineTo(t.vertices[0].x,t.vertices[0].y),e.closePath(),e.fillStyle=this.color,this.strokeStyle&&(e.lineWidth=this.lineWidth,e.strokeStyle=this.strokeStyle,e.stroke()),e.fill()},se.EditRenderer.prototype.renderPoints=function(e){var t=this.parent.mesh;e.fillStyle=this.pointColor,e.strokeStyle="white",e.lineWidth=1;for(var i=0;i<t.vertices.length;i++)e.beginPath(),e.arc(t.vertices[i].x,t.vertices[i].y,3,0,2*Math.PI),e.fill(),e.stroke()},se.EditRenderer.prototype.json=function(){return{type:"EditRenderer",fillColor:this.color,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth,pointColor:this.pointColor}},se.GradientRenderer=function(e,t){se.Renderer.call(this),this.color1=e||"#004CB3",this.color2=t||"#8ED6FF"},se.inherit(se.Renderer,se.GradientRenderer),se.GradientRenderer.prototype.setParent=function(e){this.parent=e},se.GradientRenderer.prototype.render=function(e,t){var i=e.createLinearGradient(150,0,150,300);i.addColorStop(0,this.color1),i.addColorStop(1,this.color2),e.fillStyle=i,e.fillRect(t.x,t.y,t.width,t.height)},se.GradientRenderer.prototype.json=function(){return{type:"GradientRenderer",color1:this.color1,color2:this.color2}},se.ImageRenderer=function(e,t,i){se.Renderer.call(this),this.img=new Image,this.img.src=e,this.width=t,this.height=i},se.inherit(se.Renderer,se.ImageRenderer),se.ImageRenderer.prototype.render=function(e){e.drawImage(this.img,-this.width/2,-this.height/2,this.width,this.height)},se.ImageRenderer.prototype.json=function(){return{type:"ImageRenderer",imageSrc:this.img.src,width:this.width,height:this.height}},se.MeshRenderer=function(e,t,i){se.Renderer.call(this),this.color=e,this.strokeStyle=t,this.lineWidth=i},se.inherit(se.Renderer,se.MeshRenderer),se.MeshRenderer.prototype.render=function(e){var t=this.parent.mesh,i=e;if(t.vertices.length){i.beginPath(),i.moveTo(t.vertices[0].x,t.vertices[0]);for(var n=1;n<t.vertices.length;n++)i.lineTo(t.vertices[n].x,t.vertices[n].y);i.lineTo(t.vertices[0].x,t.vertices[0].y),i.closePath(),i.fillStyle=this.color,this.strokeStyle&&(i.lineWidth=this.lineWidth,i.strokeStyle=this.strokeStyle,i.stroke()),i.fill()}},se.MeshRenderer.prototype.json=function(){return{type:"MeshRenderer",fillColor:this.color,strokeStyle:this.strokeStyle,lineWidth:this.lineWidth}},se.RectRenderer=function(e,t,i){se.Renderer.call(this),this.color=e,this.width=t,this.height=i},se.inherit(se.Renderer,se.RectRenderer),se.RectRenderer.prototype.render=function(e){e.fillStyle=this.color,e.fillRect(-this.width/2,-this.height/2,this.width,this.height)},se.RectRenderer.prototype.json=function(){return{type:"RectRenderer",color:this.color,width:this.width,height:this.height}};