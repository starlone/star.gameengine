var se={};window.animationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}();se.windowGameMain=null;se.updateFrame=function(a){se.windowGameMain.update();animationFrame(se.updateFrame)};se.BoxCollider=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};se.BoxCollider.prototype.setParent=function(a){this.parent=a};se.BoxCollider.prototype.getExtent=function(){var a=this.parent,b=a.getX()+this.x,a=a.getY()+this.y;return new se.Extent(b,a,b+this.width,a+this.height)};se.BoxCollider.prototype.isIntersect=function(a){if(a instanceof Array)for(var b in a){if(this._isIntersect(a[b]))return!0}else return this._isIntersect(a);return!1};
se.BoxCollider.prototype._isIntersect=function(a){var b=this.getExtent();a=a.getExtent();return b.intersects(a)};se.BoxCollider.prototype.getIntersection=function(a){if(a instanceof Array)for(var b in a){var c=a[b];if(this._isIntersect(c))return this._getIntersection(c)}else return this._getIntersection(a);return null};se.BoxCollider.prototype._getIntersection=function(a){var b=this.getExtent();a=a.getExtent();return b.getIntersection(a)};
se.BoxCollider.prototype.clone=function(){return new se.BoxCollider(this.x,this.y,this.width,this.height)};se.ComponentScript=function(a){this.update=a};se.ComponentScript.prototype.setParent=function(a){this.parent=a};se.ComponentPlatformPlayerController=function(a,b,c,d){this.joystick=a;this.speed=b;this.jumpspeed=c;this.jumptime=0;this.jumptimeend=25;this.isjump=!1;this.maxH=200};
se.ComponentPlatformPlayerController.prototype.update=function(a,b){this.deltaTime=b;var c=this.joystick.getAxis("horizontal")*this.speed*b,c=c||0,d=this.joystick.getAxis("jump");if(c||d){var e=0;c&&(0<c?a.transform.rotate.x=1:0>c&&(a.transform.rotate.x=-1));d&&(e=-10);a.rigidbody.setVelocity(c,e)}};se.ComponentPlatformPlayerController.prototype.isgrounded=function(){return!this.parent.transform.canMove(0,this.gravity*this.deltaTime)};
se.ComponentPlatformPlayerController.prototype.setParent=function(a){this.parent=a};se.ComponentFollowObject=function(a){this.obj_target=a};se.ComponentFollowObject.prototype.update=function(a){a.transform.position.x=this.obj_target.transform.position.x;a.transform.position.y=this.obj_target.transform.position.y};se.ComponentFollowObject.prototype.setParent=function(a){this.parent=a};se.ComponentRigidBody=function(a){this.gravity=a};
se.ComponentRigidBody.prototype.update=function(a,b){a.transform.move(0,this.gravity*b)};se.ComponentRigidBody.prototype.setParent=function(a){this.parent=a};se.Extent=function(a,b,c,d){this.min={x:a,y:b};this.max={x:c,y:d}};se.Extent.createEmpty=function(){return new se.Extent(Infinity,Infinity,-Infinity,-Infinity)};se.Extent.prototype.isEmpty=function(a){return this.max.x<this.min.x||this.max.y<this.min.y};se.Extent.prototype.intersects=function(a){return this.min.x<=a.max.x&&this.max.x>=a.min.x&&this.min.y<=a.max.y&&this.max.y>=a.min.y};
se.Extent.prototype.getIntersection=function(a){var b=se.Extent.createEmpty();if(this.intersects(a))b.min.x=this.min.x>a.min.x?this.min.x:a.min.x,b.min.y=this.min.y>a.min.y?this.min.y:a.min.y,b.max.x=this.max.x<a.max.x?this.max.x:a.max.x,b.max.y=this.max.y<a.max.y?this.max.y:a.max.y;else return null;return b};se.Extent.prototype.getWidth=function(){return this.max.x-this.min.x};se.Extent.prototype.getHeight=function(){return this.max.y-this.min.y};se.GameObject=function(a,b,c,d,e,f){this.name=a;this.transform=new se.Transform(this,b,c);this.width=d;this.height=e;this.components=[];this.colliders=[];this.parent=this.renderer=null;this.children=[];f=f||{};this.isStatic=f.isStatic||!1;this.isSleeping=f.isSleeping||!1;this.angle=0;this.rigidbody=f.rigidbody||null};se.GameObject.prototype.getX=function(){return this.transform.position.x};se.GameObject.prototype.getY=function(){return this.transform.position.y};se.GameObject.prototype.getWidth=function(){return this.width};
se.GameObject.prototype.getHeight=function(){return this.height};se.GameObject.prototype.getColliders=function(){return this.colliders};se.GameObject.prototype.setRenderer=function(a){a.setParent(this);this.renderer=a};se.GameObject.prototype.update=function(a){this.rigidbody&&this.rigidbody.update(a);for(var b in this.components)this.components[b].update(this,a);for(b in this.children)this.children[b].update(a)};
se.GameObject.prototype.render=function(a){var b=this.transform.position,c=this.transform.rotate;a.translate(b.x,b.y);a.rotate(this.angle);a.scale(c.x,1);this.renderer&&this.renderer.render(a);for(var d in this.children)this.children[d].render(a);a.scale(c.x,1);a.rotate(-this.angle);a.translate(-b.x,-b.y)};se.GameObject.prototype.addComponent=function(a){this.components.push(a);a.setParent(this);return this};
se.GameObject.prototype.addCollider=function(a){this.colliders.push(a);a.setParent(this);return this};se.GameObject.prototype.setRigidBody=function(a){this.rigidbody=a;Matter.World.add(this.parent.matterengine.world,a.body);a.setParent(this);return this};se.GameObject.prototype.setParent=function(a){this.parent=a};se.GameObject.prototype.addChild=function(a){this.children.push(a);a.setParent(this)};
se.Transform=function(a,b,c){this.parent=a;this.position=new se.Vector(b,c);this.rotate=new se.Vector(1,0)};se.Transform.prototype.change=function(a,b){this.position.change(a,b)};se.Transform.prototype.move=function(a,b){this.position.x+=a;this.position.y+=b;this.resolveCollision(a,b)};
se.Transform.prototype.resolveCollision=function(a,b){var c=this.parent,d=c.parent.getObjs(),e=c.getColliders(),f;for(f in e){var g=e[f],k;for(k in d){var h=d[k];c!=h&&(h=g.getIntersection(h.getColliders()))&&(0!=a&&(this.position.x=0>a?this.position.x+(h.getWidth()+.01):this.position.x-(h.getWidth()+.01)),0!=b&&(this.position.y=0>b?this.position.y+(h.getHeight()+.01):this.position.y-(h.getHeight()+.01)))}}};
se.Transform.prototype.canMove=function(a,b){var c=this.parent,d=c.parent.getObjs(),e=c.getColliders(),f;for(f in e){var g=e[f].clone();g.setParent(c);g.x+=a;g.y+=b;for(var k in d){var h=d[k];if(c!=h&&g.isIntersect(h.getColliders()))return!1}}return!0};se.Transform.prototype.getXY=function(){var a=this.position.x,b=this.position.y,c=this.parent.parent;c instanceof se.GameObject&&(a+=c.transform.position.x,b+=c.transform.position.y);return{x:a,y:b}};
se.Collision=function(a,b,c){this.objA=a;this.objB=b;this.intersection=c};se.Joystick=function(){this.jump=!1;this.keyhandler=new se.KeyboardHandler(this)};se.Joystick.prototype.getAxis=function(a){return"horizontal"==a?this.x:"vertical"==a?this.y:"jump"==a?this.jump:0};se.Joystick.prototype.setAxis=function(a,b){"horizontal"==a&&(this.x=b);"vertical"==a&&(this.y=b);"jump"==a&&(this.jump=b)};se.Joystick.prototype.resetAxis=function(){this.y=this.x=0;this.jump=!1};
se.KeyboardHandler=function(a){var b=this;this.joy=a;document.addEventListener("keydown",function(a){b.keydown(a.keyCode)});document.addEventListener("keyup",function(a){b.keyup(a.keyCode)})};se.KeyboardHandler.prototype.keydown=function(a){"65"==a||"37"==a?this.joy.setAxis("horizontal",-1):"68"==a||"39"==a?this.joy.setAxis("horizontal",1):"87"==a?this.joy.setAxis("vertical",-1):"83"==a?this.joy.setAxis("vertical",1):"32"==a&&this.joy.setAxis("jump",!0)};
se.KeyboardHandler.prototype.keyup=function(a){"65"==a||"68"==a||"37"==a||"39"==a?this.joy.setAxis("horizontal",0):"87"==a||"83"==a?this.joy.setAxis("vertical",0):"32"==a&&this.joy.setAxis("jump",!1)};se.BoxRenderer=function(a){this.color=a};se.BoxRenderer.prototype.render=function(a){var b=this.parent;a.fillStyle=this.color;a.fillRect(-b.width/2,-b.height/2,b.width,b.height)};se.BoxRenderer.prototype.setParent=function(a){this.parent=a};se.ImageRenderer=function(a){this.img=new Image;this.is_load=!1;this.img.src=a};se.ImageRenderer.prototype.render=function(a){var b=this.parent;a.drawImage(this.img,-b.width/2,-b.height/2,b.width,b.height)};
se.ImageRenderer.prototype.setParent=function(a){this.parent=a};se.GradientRenderer=function(a,b){this.color1=a||"#004CB3";this.color2=b||"#8ED6FF"};se.GradientRenderer.prototype.setParent=function(a){this.parent=a};se.GradientRenderer.prototype.render=function(a,b){var c=a.createLinearGradient(150,0,150,300);c.addColorStop(0,this.color1);c.addColorStop(1,this.color2);a.fillStyle=c;a.fillRect(b.x,b.y,b.width,b.height)};se.RigidBody=function(a,b){this.parent=a;b=b||{};this.force=new se.Vector(0,0);this.velocity=new se.Vector(0,0);this.speed=0;this.positionPrev=this.parent.transform.position.clone();this.frictionAir=.01;this.mass=b.mass||6.4;this.timeScale=1;this.torque=this.anglePrev=this.angle=this.angularVelocity=0};
se.RigidBody.prototype.update=function(a){var b=this.parent.transform.position,c=Math.pow(1*a*this.timeScale,2);a=1-this.frictionAir*a*this.timeScale;var d=b.y-this.positionPrev.y;this.velocity.x=(b.x-this.positionPrev.x)*a*1+this.force.x/this.mass*c;this.velocity.y=d*a*1+this.force.y/this.mass*c;this.positionPrev.x=b.x;this.positionPrev.y=b.y;b.x+=this.velocity.x;b.y+=this.velocity.y;this.speed=this.velocity.getMagnitude()};
se.RigidBody.prototype.setVelocity=function(a,b){var c=new se.Vector(a,b),d=this.parent.transform.position;this.positionPrev.x=d.x-c.x;this.positionPrev.y=d.y-c.y;this.velocity.x=c.x;this.velocity.y=c.y;this.speed=this.velocity.getMagnitude()};se.RigidBody.prototype.applyForce=function(a,b,c){a=this.parent.transform.position;this.force.x+=c.x;this.force.y+=c.y;this.torque+=(b.x-a.position.x)*c.y-(b.y-a.position.y)*c.x};se.RigidBodyMatter=function(a,b){this.parent=a;var c=a.transform.position;b=b||{};b.width||a.getWidth();b.height||a.getHeight();this.body=Matter.Bodies.rectangle(c.x,c.y,a.getWidth(),a.getHeight(),{isStatic:a.isStatic})};se.RigidBodyMatter.prototype.update=function(a){a=this.parent.transform.position;a.x=this.body.position.x;a.y=this.body.position.y;this.parent.angle=this.body.angle};se.RigidBodyMatter.prototype.setParent=function(a){this.parent=a};
se.RigidBodyMatter.prototype.setVelocity=function(a,b){Matter.Body.setVelocity(this.body,{x:a,y:b})};se.Scene=function(a,b){this.parent=a;this.camera=new se.GameObject("MainCamera",0,0,0,0);this.camera.setParent(this);this.pivot=new se.Transform(this,0,0);this.objs=[this.camera];this.gravity={x:0,y:1,scale:.003};b?this.renderer=b:(this.renderer=new se.GradientRenderer("#8ED6FF","#004CB3"),this.renderer.setParent(this));this.matterengine=Matter.Engine.create(this.parent.element);Matter.Engine.run(this.matterengine)};se.Scene.prototype.getWidth=function(){return this.parent.getWidth()};
se.Scene.prototype.getHeight=function(){return this.parent.getHeight()};se.Scene.prototype.getCamera=function(){return this.camera};se.Scene.prototype.getObjs=function(){return this.objs};se.Scene.prototype.setParent=function(a){this.parent=a};se.Scene.prototype.add=function(a){this.objs.push(a);a.setParent(this)};se.Scene.prototype.update=function(a){for(var b in this.objs)this.objs[b].update(a)};
se.Scene.prototype._applyGravity=function(a,b){var c="undefined"!==typeof b.scale?b.scale:.001;if((0!==b.x||0!==b.y)&&0!==c)for(var d in a){var e=a[d];e.isStatic||e.isSleeping||(e=e.rigidbody,e.force.y+=e.mass*b.y*c,e.force.x+=e.mass*b.x*c)}};
se.Scene.prototype._resolveColliders=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(!d.isStatic&&!d.isSleeping)for(var e=0;e<a.length;e++)if(c!=e){var f=a[e],g=this._checkCollision(d,f);g&&b.push(g)}}for(c in b)if(g=b[c],g.objB.isStatic||f.isSleeping)a=g.objA.rigidbody.velocity,d=g.objA.transform.position,d.y=0<a.y?d.y-(g.intersection.getHeight()+.01):d.y+(g.intersection.getHeight()+.01),a.x=0,a.y=0};
se.Scene.prototype._checkCollision=function(a,b){var c=a.getColliders(),d=b.getColliders(),e;for(e in c){var f=c[e];if(f.isIntersect(d))return new se.Collision(a,b,f.getIntersection(d))}};se.Scene.prototype._clearForces=function(a){for(var b in a){var c=a[b].rigidbody;c.force.x=0;c.force.y=0;c.torque=0}};se.Scene.prototype.render=function(a){this.updatePivot(a);this.clearframe(a);this.renderBackground(a);for(var b in this.objs)this.objs[b].render(a)};
se.Scene.prototype.renderBackground=function(a){this.renderer.render(a,{x:this.pivot.position.x,y:this.pivot.position.y,width:this.getWidth(),height:this.getHeight()})};se.Scene.prototype.clearframe=function(a){a.clearRect(this.pivot.position.x,this.pivot.position.y,this.getWidth(),this.getHeight())};se.Scene.prototype.updatePivot=function(a){a.setTransform(1,0,0,1,0,0);var b=this.camera.transform.position,c=b.x-this.getWidth()/2,b=b.y-this.getHeight()/2;this.pivot.change(c,b);a.translate(-c,-b)};
se.Scene.prototype.resetCamera=function(){this.pivot.change(0,0)};se.StarEngine=function(a){var b=this;this.element=a?document.getElementById(a):document.body;this.element.getContext&&(this.ctx=canvas.getContext("2d"));this.lastTime=Date.now();this.scenes=[];this.joystick=new se.Joystick;b.updateSize();window.addEventListener("resize",function(){b.getSceneCurrent().resetCamera();b.updateSize()})};se.StarEngine.prototype.getWidth=function(){return this.element.width};se.StarEngine.prototype.getHeight=function(){return this.element.height};
se.StarEngine.prototype.getSceneCurrent=function(){return this.scenes[0]};se.StarEngine.prototype.setSize=function(a,b){this.element.width=a;this.element.height=b};se.StarEngine.prototype.updateSize=function(){var a=this.element.parentElement;this.setSize(a.offsetWidth,a.offsetHeight)};se.StarEngine.prototype.getContext=function(){return this.ctx};se.StarEngine.prototype.addScene=function(a){this.scenes.push(a);a.setParent(this)};
se.StarEngine.prototype.update=function(){var a=Date.now(),b=a-this.lastTime,c=this.getSceneCurrent();c.update(b);c.render(this.ctx);this.lastTime=a};se.StarEngine.prototype.init=function(){se.windowGameMain=this;animationFrame(se.updateFrame)};se.Vector=function(a,b){this.x=a;this.y=b};se.Vector.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};se.Vector.prototype.clone=function(){return new se.Vector(this.x,this.y)};se.Vector.prototype.change=function(a,b){this.x=a;this.y=b};se.Vector.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};se.Vector.prototype.sub=function(a,b){var c;c=b?this:new se.Vector(0,0);c.x=this.x-a.x;c.y=this.y-a.y;return c};
se.Vector.prototype.add=function(a,b){var c;c=b?this:new se.Vector(0,0);c.x=this.x+a.x;c.y=this.y+a.y;return c};
