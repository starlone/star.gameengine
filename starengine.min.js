var se={};"undefined"!==typeof window&&(window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(function(){a(new Date.now)},1E3/60)}}(),window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame);se.BoxCollider=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};se.BoxCollider.prototype.setParent=function(a){this.parent=a};se.BoxCollider.prototype.getExtent=function(){var a=this.parent,b=a.getX()+this.x,a=a.getY()+this.y;return new se.Extent(b,a,b+this.width,a+this.height)};se.BoxCollider.prototype.isIntersect=function(a){if(a instanceof Array)for(var b in a){if(this._isIntersect(a[b]))return!0}else return this._isIntersect(a);return!1};
se.BoxCollider.prototype._isIntersect=function(a){var b=this.getExtent();a=a.getExtent();return b.intersects(a)};se.BoxCollider.prototype.getIntersection=function(a){if(a instanceof Array)for(var b in a){var c=a[b];if(this._isIntersect(c))return this._getIntersection(c)}else return this._getIntersection(a);return null};se.BoxCollider.prototype._getIntersection=function(a){var b=this.getExtent();a=a.getExtent();return b.getIntersection(a)};
se.BoxCollider.prototype.clone=function(){return new se.BoxCollider(this.x,this.y,this.width,this.height)};se.ComponentScript=function(a){this.update=a};se.ComponentScript.prototype.setParent=function(a){this.parent=a};se.ComponentPlatformPlayerController=function(a,b,c,d){this.joystick=a;this.speed=b};
se.ComponentPlatformPlayerController.prototype.update=function(a,b){var c=this.joystick.getAxis("horizontal")*b/10,c=c||0,d=this.joystick.getAxis("jump");if(c||d){var e=a.rigidbody.body.velocity,c=e.x+c,f=e.y;0<c?a.transform.rotate.x=1:0>c&&(a.transform.rotate.x=-1);16<c&&(c=16);-16>c&&(c=-16);d&&1>e.y&&-1<e.y&&(f=-13);a.rigidbody.setVelocity({x:c,y:f})}};se.ComponentPlatformPlayerController.prototype.setParent=function(a){this.parent=a};se.ComponentFollowObject=function(a){this.obj_target=a};
se.ComponentFollowObject.prototype.update=function(a){a.transform.position.x=this.obj_target.transform.position.x;a.transform.position.y=this.obj_target.transform.position.y};se.ComponentFollowObject.prototype.setParent=function(a){this.parent=a};se.Extent=function(a,b,c,d){this.min={x:a,y:b};this.max={x:c,y:d}};se.Extent.createEmpty=function(){return new se.Extent(Infinity,Infinity,-Infinity,-Infinity)};se.Extent.prototype.isEmpty=function(a){return this.max.x<this.min.x||this.max.y<this.min.y};se.Extent.prototype.intersects=function(a){return this.min.x<=a.max.x&&this.max.x>=a.min.x&&this.min.y<=a.max.y&&this.max.y>=a.min.y};
se.Extent.prototype.getIntersection=function(a){var b=se.Extent.createEmpty();if(this.intersects(a))b.min.x=this.min.x>a.min.x?this.min.x:a.min.x,b.min.y=this.min.y>a.min.y?this.min.y:a.min.y,b.max.x=this.max.x<a.max.x?this.max.x:a.max.x,b.max.y=this.max.y<a.max.y?this.max.y:a.max.y;else return null;return b};se.Extent.prototype.getWidth=function(){return this.max.x-this.min.x};se.Extent.prototype.getHeight=function(){return this.max.y-this.min.y};se.factory={};
se.factory.rect=function(a){var b=a||{},c=b.name||"",d=b.x||0,e=b.y||0;a=b.w||10;var f=b.h||10,g=b.image_src,k=b.fillColor||"#6B4226",h=b.objoptions||{};null==b.hasRigidbody?hasRigidbody=!0:hasRigidbody=b.hasRigidbody;h.vertices=[new se.Vector(0,0),new se.Vector(a,0),new se.Vector(a,f),new se.Vector(0,f)];b=new se.GameObject(c,d,e,h);hasRigidbody&&b.setRigidBody(new se.RigidBody({vertices:h.vertices}));g?b.setRenderer(new se.ImageRenderer(g,a,f)):b.setRenderer(new se.RectRenderer(k,a,f));return b};
se.factory.circle=function(a){var b=a||{},c=b.name||"",d=b.x||0,e=b.y||0;a=b.radius||10;var f=b.objoptions||{},g=b.maxSides||25;null==b.hasRigidbody?hasRigidbody=!0:hasRigidbody=b.hasRigidbody;var k=b.fillColor,h=b.strokeColor,b=b.lineWidth;f.vertices=se.factory.createCircleVertices(a,g);c=new se.GameObject(c,d,e,f);hasRigidbody&&c.setRigidBody(new se.RigidBody(f));c.setRenderer(new se.CircleRenderer(a,k,h,b));return c};
se.factory.createCircleVertices=function(a,b){var c=Math.ceil(Math.max(10,Math.min(b||25,a)));1===c%2&&(c+=1);for(var d=2*Math.PI/c,e="",f=.5*d,g=0;g<c;g+=1)var k=f+g*d,h=Math.sin(k)*a,e=e+("L "+(Math.cos(k)*a).toFixed(3)+" "+h.toFixed(3)+" ");return Matter.Vertices.fromPath(e)};se.GameObject=function(a,b,c,d){this.name=a;this.transform=new se.Transform(this,b,c);this.components=[];this.colliders=[];this.parent=this.renderer=null;this.children=[];d=d||{};this.isStatic=null!=d.isStatic?d.isStatic:!1;this.isSleeping=d.isSleeping||!1;this.canRotate=null!=d.canRotate?d.canRotate:!0;this.mesh=d.mesh||new se.Mesh({vertices:d.vertices});this.rigidbody=d.rigidbody||null;this.angle=0};se.GameObject.prototype.getX=function(){return this.transform.position.x};
se.GameObject.prototype.getY=function(){return this.transform.position.y};se.GameObject.prototype.getWidth=function(){return this.width};se.GameObject.prototype.getHeight=function(){return this.height};se.GameObject.prototype.getScene=function(){for(var a=this.parent;null!=a&&0==a instanceof se.Scene;)a=a.parent;return a};se.GameObject.prototype.getColliders=function(){return this.colliders};se.GameObject.prototype.setRenderer=function(a){a.setParent(this);this.renderer=a};
se.GameObject.prototype.update=function(a,b){this.rigidbody&&this.rigidbody.update(a,b);for(var c in this.components)this.components[c].update(this,a,b);for(c in this.children)this.children[c].update(a,b)};
se.GameObject.prototype.render=function(a){var b=this.transform.position,c=this.transform.rotate;a.translate(b.x,b.y);a.rotate(this.angle);a.scale(c.x,1);this.renderer&&this.renderer.render(a);for(var d in this.children)this.children[d].render(a);a.scale(c.x,1);a.rotate(-this.angle);a.translate(-b.x,-b.y)};se.GameObject.prototype.addComponent=function(a){this.components.push(a);a.setParent(this);return this};
se.GameObject.prototype.addCollider=function(a){this.colliders.push(a);a.setParent(this);return this};se.GameObject.prototype.setRigidBody=function(a){this.rigidbody=a;a.setParent(this);return this};se.GameObject.prototype.setParent=function(a){this.parent=a};se.GameObject.prototype.addChild=function(a){this.children.push(a);a.setParent(this)};se.Transform=function(a,b,c){this.parent=a;this.position=new se.Vector(b,c);this.rotate=new se.Vector(1,0)};
se.Transform.prototype.change=function(a,b){this.position.change(a,b)};se.Transform.prototype.move=function(a,b){this.position.x+=a;this.position.y+=b;this.resolveCollision(a,b)};se.Transform.prototype.getXY=function(){var a=this.position.x,b=this.position.y,c=this.parent.parent;c instanceof se.GameObject&&(a+=c.transform.position.x,b+=c.transform.position.y);return{x:a,y:b}};se.Joystick=function(){this.jump=!1;this.keyhandler=new se.KeyboardHandler(this)};se.Joystick.prototype.getAxis=function(a){return"horizontal"==a?this.x:"vertical"==a?this.y:"jump"==a?this.jump:0};se.Joystick.prototype.setAxis=function(a,b){"horizontal"==a&&(this.x=b);"vertical"==a&&(this.y=b);"jump"==a&&(this.jump=b)};se.Joystick.prototype.resetAxis=function(){this.y=this.x=0;this.jump=!1};
se.KeyboardHandler=function(a){var b=this;this.joy=a;document.addEventListener("keydown",function(a){b.keydown(a.keyCode)});document.addEventListener("keyup",function(a){b.keyup(a.keyCode)})};se.KeyboardHandler.prototype.keydown=function(a){"65"==a||"37"==a?this.joy.setAxis("horizontal",-1):"68"==a||"39"==a?this.joy.setAxis("horizontal",1):"87"==a?this.joy.setAxis("vertical",-1):"83"==a?this.joy.setAxis("vertical",1):"32"==a&&this.joy.setAxis("jump",!0)};
se.KeyboardHandler.prototype.keyup=function(a){"65"==a||"68"==a||"37"==a||"39"==a?this.joy.setAxis("horizontal",0):"87"==a||"83"==a?this.joy.setAxis("vertical",0):"32"==a&&this.joy.setAxis("jump",!1)};se.Mesh=function(a){a=a||{};this.vertices=a.vertices||[]};se.Mesh.prototype.setVertices=function(a){this.vertices=a};se.Mesh.prototype.getVertices=function(){return this.vertices};se.RectRenderer=function(a,b,c){this.color=a;this.width=b;this.height=c};se.RectRenderer.prototype.render=function(a){a.fillStyle=this.color;a.fillRect(-this.width/2,-this.height/2,this.width,this.height)};se.RectRenderer.prototype.setParent=function(a){this.parent=a};se.CircleRenderer=function(a,b,c,d){this.radius=a;this.fillStyle=b;this.strokeStyle=c;this.lineWidth=d||1};
se.CircleRenderer.prototype.render=function(a){a.beginPath();a.fillStyle=this.fillStyle;this.strokeStyle&&(a.strokeStyle=this.strokeStyle,a.lineWidth=this.lineWidth);a.arc(0,0,this.radius,0,2*Math.PI);a.fill();this.strokeStyle&&a.stroke()};se.CircleRenderer.prototype.setParent=function(a){this.parent=a};se.ImageRenderer=function(a,b,c){this.img=new Image;this.is_load=!1;this.img.src=a;this.width=b;this.height=c};
se.ImageRenderer.prototype.render=function(a){a.drawImage(this.img,-this.width/2,-this.height/2,this.width,this.height)};se.ImageRenderer.prototype.setParent=function(a){this.parent=a};se.GradientRenderer=function(a,b){this.color1=a||"#004CB3";this.color2=b||"#8ED6FF"};se.GradientRenderer.prototype.setParent=function(a){this.parent=a};
se.GradientRenderer.prototype.render=function(a,b){var c=a.createLinearGradient(150,0,150,300);c.addColorStop(0,this.color1);c.addColorStop(1,this.color2);a.fillStyle=c;a.fillRect(b.x,b.y,b.width,b.height)};se.MeshRenderer=function(a,b,c){this.color=color;this.strokeColor=b;this.lineWidth=c};se.MeshRenderer.prototype.setParent=function(a){this.parent=a};
se.MeshRenderer.prototype.render=function(a){var b=this.parent.transform.position,c=this.parent.mesh;a.beginPath();for(var d=1;d<c.vertices.length;d++){var e=c.vertices[d].x-b.x,f=c.vertices[d].y-b.y;!c.vertices[d-1].isInternal||showInternalEdges?a.lineTo(e,f):a.moveTo(e,f);c.vertices[d].isInternal&&!showInternalEdges&&(e=c.vertices[(d+1)%c.vertices.length].x-b.x,f=c.vertices[(d+1)%c.vertices.length].y-b.y,a.moveTo(e,f))}a.lineTo(c.vertices[0].x-b.x,c.vertices[0].y-b.y);a.closePath();a.fillStyle=
this.color;this.strokeStyle&&(a.lineWidth=this.lineWidth,a.strokeStyle=this.strokeStyle);a.fill();a.stroke()};se.RigidBody=function(a){this.options=a};
se.RigidBody.prototype.createBody=function(){var a=this.parent,b=a.transform.position;options=this.options||{};var c=options.x||b.x,b=options.y||b.y;this.isPermeable=null!=options.isPermeable?options.isPermeable:!1;delete options.x;delete options.y;delete options.isPermeable;options.isStatic=a.isStatic;options.canRotate=a.canRotate;a={label:"Rectangle Body",position:{x:c,y:b},vertices:a.mesh.getVertices()};this.body=Matter.Body.create(Matter.Common.extend({},a,options))};
se.RigidBody.prototype.update=function(a){a=this.parent.transform.position;a.x=this.body.position.x;a.y=this.body.position.y;this.parent.angle=this.body.angle};se.RigidBody.prototype.setParent=function(a){this.parent=a;this.createBody()};se.RigidBody.prototype.setPermeable=function(a){var b=this.parent.getScene();1==a&&0==this.isPermeable?b.removeBody(this.body):0==a&&1==this.isPermeable&&b.addBody(this.body);this.isPermeable=a};
se.RigidBody.prototype.setVelocity=function(a){Matter.Sleeping.set(this.body,!1);Matter.Body.setVelocity(this.body,a)};se.RigidBody.prototype.applyForce=function(a,b){Matter.Body.applyForce(this.body,a,b)};se.RigidBody.prototype.setAngularVelocity=function(a){Matter.Body.setAngularVelocity(this.body,a)};
Matter.Body.update=function(a,b,c,d){var e=Matter.Bounds,f=Matter.Vector,g=Matter.Vertices,k=Matter.Axes;b=Math.pow(b*c*a.timeScale,2);c=1-a.frictionAir*c*a.timeScale;var h=a.position.y-a.positionPrev.y;a.velocity.x=(a.position.x-a.positionPrev.x)*c*d+a.force.x/a.mass*b;a.velocity.y=h*c*d+a.force.y/a.mass*b;a.positionPrev.x=a.position.x;a.positionPrev.y=a.position.y;a.position.x+=a.velocity.x;a.position.y+=a.velocity.y;a.angularVelocity=a.canRotate?(a.angle-a.anglePrev)*c*d+a.torque/a.inertia*b:0;
a.anglePrev=a.angle;a.angle+=a.angularVelocity;a.speed=f.magnitude(a.velocity);a.angularSpeed=Math.abs(a.angularVelocity);for(d=0;d<a.parts.length;d++)b=a.parts[d],g.translate(b.vertices,a.velocity),0<d&&(b.position.x+=a.velocity.x,b.position.y+=a.velocity.y),0!==a.angularVelocity&&(g.rotate(b.vertices,a.angularVelocity,a.position),k.rotate(b.axes,a.angularVelocity),0<d&&f.rotateAbout(b.position,a.angularVelocity,a.position,b.position)),e.update(b.bounds,b.vertices,a.velocity)};se.Scene=function(a,b){this.parent=a;this.camera=new se.GameObject("MainCamera",0,0,0,0);this.pivot=new se.Transform(this,0,0);this.objs=[];this.add(this.camera);b?this.renderer=b:(this.renderer=new se.GradientRenderer("#8ED6FF","#004CB3"),this.renderer.setParent(this));this.matterengine=Matter.Engine.create(this.parent.element);this.matterengine.enableSleeping=!0};se.Scene.prototype.getWidth=function(){return this.parent.getWidth()};se.Scene.prototype.getHeight=function(){return this.parent.getHeight()};
se.Scene.prototype.getCamera=function(){return this.camera};se.Scene.prototype.getObjs=function(){return this.objs};se.Scene.prototype.setParent=function(a){this.parent=a};se.Scene.prototype.add=function(a){this.objs.push(a);a.setParent(this);a.rigidbody&&this.addBody(a.rigidbody.body)};se.Scene.prototype.addBody=function(a){Matter.World.add(this.matterengine.world,a)};se.Scene.prototype.removeBody=function(a){Matter.Composite.removeBody(this.matterengine.world,a)};
se.Scene.prototype.update=function(a,b){Matter.Engine.update(this.matterengine,a,b);for(var c in this.objs)this.objs[c].update(a,b)};se.Scene.prototype.render=function(a){this.updatePivot(a);this.clearframe(a);this.renderBackground(a);for(var b in this.objs)this.objs[b].render(a)};se.Scene.prototype.renderBackground=function(a){this.renderer.render(a,{x:this.pivot.position.x,y:this.pivot.position.y,width:this.getWidth(),height:this.getHeight()})};
se.Scene.prototype.clearframe=function(a){a.clearRect(this.pivot.position.x,this.pivot.position.y,this.getWidth(),this.getHeight())};se.Scene.prototype.updatePivot=function(a){a.setTransform(1,0,0,1,0,0);var b=this.camera.transform.position,c=b.x-this.getWidth()/2,b=b.y-this.getHeight()/2;this.pivot.change(c,b);a.translate(-c,-b)};se.Scene.prototype.resetCamera=function(){this.pivot.change(0,0)};se.StarEngine=function(a){var b=this;this.element=a?document.getElementById(a):document.body;this.element.getContext&&(this.ctx=this.element.getContext("2d"));this.scenes=[];this.joystick=new se.Joystick;b.updateSize();window.addEventListener("resize",function(){b.getSceneCurrent().resetCamera();b.updateSize()});a={fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0,timing:{timestamp:0,timeScale:1}};
a.delta=a.delta||1E3/a.fps;a.deltaMin=a.deltaMin||1E3/a.fps;a.deltaMax=a.deltaMax||1E3/(.5*a.fps);a.fps=1E3/a.delta;this.runner=a};se.StarEngine.prototype.getWidth=function(){return this.element.width};se.StarEngine.prototype.getHeight=function(){return this.element.height};se.StarEngine.prototype.getSceneCurrent=function(){return this.scenes[0]};se.StarEngine.prototype.setSize=function(a,b){this.element.width=a;this.element.height=b};
se.StarEngine.prototype.updateSize=function(){var a=this.element.parentElement;this.setSize(a.offsetWidth,a.offsetHeight)};se.StarEngine.prototype.getContext=function(){return this.ctx};se.StarEngine.prototype.addScene=function(a){this.scenes.push(a);a.setParent(this)};
se.StarEngine.prototype.update=function(a){var b=this.runner,c=b.timing,d=1,e;b.isFixed?e=b.delta:(e=a-b.timePrev||b.delta,b.timePrev=a,b.deltaHistory.push(e),b.deltaHistory=b.deltaHistory.slice(-b.deltaSampleSize),e=Math.min.apply(null,b.deltaHistory),e=e<b.deltaMin?b.deltaMin:e,e=e>b.deltaMax?b.deltaMax:e,d=e/b.delta,b.delta=e);0!==b.timeScalePrev&&(d*=c.timeScale/b.timeScalePrev);0===c.timeScale&&(d=0);b.timeScalePrev=c.timeScale;b.correction=d;b.frameCounter+=1;1E3<=a-b.counterTimestamp&&(b.fps=
(a-b.counterTimestamp)/1E3*b.frameCounter,b.counterTimestamp=a,b.frameCounter=0);a=this.getSceneCurrent();a.update(e,d);a.render(this.ctx)};se.StarEngine.prototype.run=function(){var a=this.runner,b=this;(function d(e){a.frameRequestId=window.requestAnimationFrame(d);e&&a.enabled&&b.update(e)})();return a};se.StarEngine.prototype.pause=function(a){null==a&&(a=!0);this.runner.enabled=!a};se.Vector=function(a,b){this.x=a;this.y=b};se.Vector.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};se.Vector.prototype.clone=function(){return new se.Vector(this.x,this.y)};se.Vector.prototype.change=function(a,b){this.x=a;this.y=b};se.Vector.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};se.Vector.prototype.sub=function(a,b){var c;c=b?this:new se.Vector(0,0);c.x=this.x-a.x;c.y=this.y-a.y;return c};
se.Vector.prototype.add=function(a,b){var c;c=b?this:new se.Vector(0,0);c.x=this.x+a.x;c.y=this.y+a.y;return c};
