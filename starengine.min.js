var se={};window.animationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}();se.windowGameMain=null;se.updateFrame=function(){se.windowGameMain.update();animationFrame(se.updateFrame)};se.WindowGame=function(a){var b=this;this.element=document.getElementById(a);this.element.getContext&&(this.ctx=canvas.getContext("2d"));this.scenes=[];this.joystick=new se.Joystick;b.updateSize();$(window).resize(function(){b.getSceneCurrent().resetCamera();b.updateSize()})};se.WindowGame.prototype.getWidth=function(){return this.element.width};se.WindowGame.prototype.getHeight=function(){return this.element.height};se.WindowGame.prototype.getSceneCurrent=function(){return this.scenes[0]};
se.WindowGame.prototype.setSize=function(a,b){this.element.width=a;this.element.height=b};se.WindowGame.prototype.updateSize=function(){var a=$(this.element).parent();this.setSize(a.width(),a.height())};se.WindowGame.prototype.getContext=function(){return this.ctx};se.WindowGame.prototype.addScene=function(a){this.scenes.push(a);a.parent=this};se.WindowGame.prototype.render=function(){this.getSceneCurrent().render(this.ctx)};se.WindowGame.prototype.update=function(){this.render()};
se.WindowGame.prototype.init=function(){se.windowGameMain=this;animationFrame(se.updateFrame)};se.GameObject=function(a,b,c,d,e){this.name=a;this.transform=new se.Transform(this,b,c);this.width=d;this.height=e;this.components=[];this.colliders=[];this.parent=this.renderer=null;this.children=[]};se.GameObject.prototype.getX=function(){return this.transform.position.x};se.GameObject.prototype.getY=function(){return this.transform.position.y};se.GameObject.prototype.getWidth=function(){return this.width};se.GameObject.prototype.getHeight=function(){return this.height};
se.GameObject.prototype.getColliders=function(){return this.colliders};se.GameObject.prototype.setRenderer=function(a){a.setParent(this);this.renderer=a};se.GameObject.prototype.render=function(a){this.update();this.renderer&&this.renderer.render(a);for(var b in this.children)this.children[b].render(a)};se.GameObject.prototype.update=function(){for(var a in this.components)this.components[a].update(this);for(a in this.children)this.children[a].update()};
se.GameObject.prototype.addComponent=function(a){this.components.push(a);a.setParent(this);return this};se.GameObject.prototype.addCollider=function(a){this.colliders.push(a);a.setParent(this);return this};se.GameObject.prototype.setParent=function(a){this.parent=a};se.GameObject.prototype.addChild=function(a){this.children.push(a);a.setParent(this)};se.Position=function(a,b){this.x=a;this.y=b};se.Transform=function(a,b,c){this.parent=a;this.position=new se.Position(b,c)};
se.Transform.prototype.change=function(a,b){this.position.x=a;this.position.y=b};se.Transform.prototype.move=function(a,b){this.canMove(a,b)&&(this.position.x+=a,this.position.y+=b)};se.Transform.prototype.canMove=function(a,b){var c=this.parent,d=c.parent.getObjs(),e=c.getColliders(),g;for(g in e){var f=e[g].clone();f.setParent(c);f.x+=a;f.y+=b;for(var h in d)if(f.isIntersect(d[h].getColliders()))return!1}return!0};
se.Transform.prototype.getXY=function(){var a=this.position.x,b=this.position.y,c=this.parent.parent;c instanceof se.GameObject&&(a+=c.transform.position.x,b+=c.transform.position.y);return{x:a,y:b}};se.BoxCollider=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};se.BoxCollider.prototype.setParent=function(a){this.parent=a};se.BoxCollider.prototype.getPoints=function(){var a=this.parent,b=a.getX()+this.x,a=a.getY()+this.y,c=this.width,d=this.height,e=[];e.push([b,a]);e.push([b+c,a]);e.push([b,a+d]);e.push([b+c,a+d]);return e};
se.BoxCollider.prototype.isIntersect=function(a){if(a instanceof Array)for(var b in a){if(this._isIntersect(a[b]))return!0}else return this._isIntersect(a);return!1};se.BoxCollider.prototype._isIntersect=function(a){var b=this.getPoints(),c=a.getPoints();a=c[0];var c=c[3],d;for(d in b)if(b[d][0]>a[0]&&b[d][0]<c[0]&&b[d][1]>a[1]&&b[d][1]<c[1])return!0;return!1};se.BoxCollider.prototype.clone=function(){return new se.BoxCollider(this.x,this.y,this.width,this.height)};se.Scene=function(a){this.camera=new se.GameObject("MainCamera",0,0,0,0);this.camera.parent=this;this.camY=this.camX=0;this.objs=[this.camera];this.backcolor="rgba(135, 206, 250,1)";a&&(this.backcolor=a)};se.Scene.prototype.getWidth=function(){return this.parent.getWidth()};se.Scene.prototype.getHeight=function(){return this.parent.getHeight()};se.Scene.prototype.getCamera=function(){return this.camera};se.Scene.prototype.getObjs=function(){return this.objs};
se.Scene.prototype.add=function(a){this.objs.push(a);a.setParent(this)};se.Scene.prototype.render=function(a){this.check_move_cam(a);this.clearframe(a);this.renderBackground(a);for(var b in this.objs)this.objs[b].render(a)};se.Scene.prototype.renderBackground=function(a){a.fillStyle=this.backcolor;a.fillRect(this.camera.getX(),this.camera.getY(),this.getWidth(),this.getHeight())};se.Scene.prototype.clearframe=function(a){a.clearRect(this.camera.getX(),this.camera.getY(),this.getWidth(),this.getHeight())};
se.Scene.prototype.check_move_cam=function(a){if(this.camX!=this.camera.getX()||this.camY!=this.camera.getY()){var b=this.camX-this.camera.getX(),c=this.camY-this.camera.getY();a.translate(b,c);this.camX=this.camera.getX();this.camY=this.camera.getY()}};se.Scene.prototype.resetCamera=function(){this.camY=this.camX=0};se.BoxRenderer=function(a){this.color=a};se.BoxRenderer.prototype.render=function(a){var b=this.parent,c=b.transform.getXY();a.fillStyle=this.color;a.fillRect(c.x,c.y,b.width,b.height)};se.BoxRenderer.prototype.setParent=function(a){this.parent=a};se.ComponentScript=function(a){this.update=a};se.ComponentScript.prototype.setParent=function(a){this.parent=a};se.ComponentPlayerController=function(a,b,c){this.window=a;this.speed=b;this.gravity=c;this.jumpspeed=1.5*this.speed;this.jumptime=0;this.jumptimeend=25;this.isjump=!1};
se.ComponentPlayerController.prototype.update=function(a){var b=game.joystick.getAxis("horizontal")*this.speed;b&&a.transform.move(b,0);this.isjump?this.jumptime<this.jumptimeend?(a.transform.move(0,-1*this.jumpspeed),this.jumptime+=1):(a.transform.move(0,this.gravity),this.jumptime=0,this.isjump=!1):this.isgrounded()?game.joystick.getAxis("jump")&&(a.transform.move(0,-1*this.jumpspeed),this.isjump=!0):a.transform.move(0,this.gravity)};
se.ComponentPlayerController.prototype.isgrounded=function(){return!this.parent.transform.canMove(0,this.gravity)};se.ComponentPlayerController.prototype.setParent=function(a){this.parent=a};se.ComponentFollowPlayer=function(a){this.obj_player=a};
se.ComponentFollowPlayer.prototype.update=function(a){var b=this.parent.parent,c=b.getWidth()/2-this.obj_player.getWidth()/2,c=this.obj_player.getX()+this.obj_player.getWidth()/2-c,b=b.getHeight()/2-this.obj_player.getHeight()/2,b=this.obj_player.getY()+this.obj_player.getHeight()/2-b;a.transform.change(c,b)};se.ComponentFollowPlayer.prototype.setParent=function(a){this.parent=a};se.ComponentRigidBody=function(a){this.gravity=a};
se.ComponentRigidBody.prototype.update=function(a){a.transform.move(0,this.gravity)};se.ComponentRigidBody.prototype.setParent=function(a){this.parent=a};se.Joystick=function(){this.jump=!1;this.keyhandler=new se.KeyboardHandler(this)};se.Joystick.prototype.getAxis=function(a){return"horizontal"==a?this.x:"vertical"==a?this.y:"jump"==a?this.jump:0};se.Joystick.prototype.setAxis=function(a,b){"horizontal"==a&&(this.x=b);"vertical"==a&&(this.y=b);"jump"==a&&(this.jump=b)};se.Joystick.prototype.resetAxis=function(){this.y=this.x=0;this.jump=!1};
se.KeyboardHandler=function(a){var b=this;this.joy=a;$(document).keydown(function(a){b.keydown(a.keyCode)});$(document).keyup(function(a){b.keyup(a.keyCode)})};se.KeyboardHandler.prototype.keydown=function(a){"65"==a?this.joy.setAxis("horizontal",-1):"68"==a?this.joy.setAxis("horizontal",1):"87"==a?this.joy.setAxis("vertical",-1):"83"==a?this.joy.setAxis("vertical",1):"32"==a&&this.joy.setAxis("jump",!0)};
se.KeyboardHandler.prototype.keyup=function(a){"65"==a||"68"==a?this.joy.setAxis("horizontal",0):"87"==a||"83"==a?this.joy.setAxis("vertical",0):"32"==a&&this.joy.setAxis("jump",!1)};
