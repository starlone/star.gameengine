var se={};window.animationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1E3/60)}}();se.windowGameMain=null;se.updateFrame=function(){se.windowGameMain.update();animationFrame(se.updateFrame)};
se.WindowGame=function(a){var b=this;this.element=document.getElementById(a);this.element.getContext&&(this.ctx=canvas.getContext("2d"));this.scenes=[];this.joystick=new se.Joystick;b.updateSize();$(window).resize(function(){b.getSceneCurrent().resetCamera();b.updateSize()})};se.WindowGame.prototype.getWidth=function(){return this.element.width};se.WindowGame.prototype.getHeight=function(){return this.element.height};se.WindowGame.prototype.getSceneCurrent=function(){return this.scenes[0]};
se.WindowGame.prototype.setSize=function(a,b){this.element.width=a;this.element.height=b};se.WindowGame.prototype.updateSize=function(){var a=$(this.element).parent();this.setSize(a.width(),a.height())};se.WindowGame.prototype.getContext=function(){return this.ctx};se.WindowGame.prototype.addScene=function(a){this.scenes.push(a);a.parent=this};se.WindowGame.prototype.render=function(){this.getSceneCurrent().render(this.ctx)};se.WindowGame.prototype.update=function(){this.render()};
se.WindowGame.prototype.init=function(){se.windowGameMain=this;animationFrame(se.updateFrame)};se.Scene=function(a){this.camera=new se.GameObject("MainCamera",0,0,0,0);this.camera.parent=this;this.camY=this.camX=0;this.objs=[this.camera];this.backcolor="rgba(135, 206, 250,1)";a&&(this.backcolor=a)};se.Scene.prototype.getWidth=function(){return this.parent.getWidth()};se.Scene.prototype.getHeight=function(){return this.parent.getHeight()};se.Scene.prototype.getCamera=function(){return this.camera};
se.Scene.prototype.getObjs=function(){return this.objs};se.Scene.prototype.add=function(a){this.objs.push(a);a.parent=this};se.Scene.prototype.render=function(a){this.check_move_cam(a);this.clearframe(a);this.renderBackground(a);for(var b in this.objs)this.objs[b].render(a)};se.Scene.prototype.renderBackground=function(a){a.fillStyle=this.backcolor;a.fillRect(this.camera.getX(),this.camera.getY(),this.getWidth(),this.getHeight())};
se.Scene.prototype.clearframe=function(a){a.clearRect(this.camera.getX(),this.camera.getY(),this.getWidth(),this.getHeight())};se.Scene.prototype.check_move_cam=function(a){if(this.camX!=this.camera.getX()||this.camY!=this.camera.getY()){var b=this.camX-this.camera.getX(),c=this.camY-this.camera.getY();a.translate(b,c);this.camX=this.camera.getX();this.camY=this.camera.getY()}};se.Scene.prototype.resetCamera=function(){this.camY=this.camX=0};
se.GameObject=function(a,b,c,d,e){this.name=a;this.transform=new se.Transform(b,c);this.width=d;this.height=e;this.components=[];this.colliders=[];this.renderer=null};se.GameObject.prototype.getX=function(){return this.transform.position.x};se.GameObject.prototype.getY=function(){return this.transform.position.y};se.GameObject.prototype.getWidth=function(){return this.width};se.GameObject.prototype.getHeight=function(){return this.height};se.GameObject.prototype.getColliders=function(){return this.colliders};
se.GameObject.prototype.setRenderer=function(a){a.setParent(this);this.renderer=a};se.GameObject.prototype.render=function(a){this.update();this.renderer&&this.renderer.render(a)};se.GameObject.prototype.update=function(){for(var a in this.components)this.components[a].update(this)};se.GameObject.prototype.addComponent=function(a){this.components.push(a);a.setParent(this);return this};se.GameObject.prototype.addCollider=function(a){this.colliders.push(a);a.setParent(this);return this};
se.GameObject.prototype.move=function(a,b){this.transform.position.x=a;this.transform.position.y=b};se.GameObject.prototype.sum=function(a,b){var c=this.getX(),d=this.getY();this.transform.position.x+=a;this.transform.position.y+=b;this.checkCollision()&&(this.transform.position.x=c,this.transform.position.y=d)};se.GameObject.prototype.checkCollision=function(){var a=this.parent.getObjs(),b;for(b in a){var c=a[b];if(this!=c&&this.isColliding(c.getColliders()))return!0}return!1};
se.GameObject.prototype.isColliding=function(a){var b=this.getColliders(),c;for(c in b)for(var d in a)if(b[c].isIntersect(a[d]))return!0;return!1};se.Position=function(a,b){this.x=a;this.y=b};se.Transform=function(a,b){this.position=new se.Position(a,b)};se.Joystick=function(){this.key=null;var a=this;this.jump=!1;$(document).keydown(function(b){a.key=b.keyCode;a.update()});$(document).keyup(function(b){a.key=null;a.reset()})};
se.Joystick.prototype.update=function(){var a=this.key;"65"==a?this.x=-1:"68"==a?this.x=1:"87"==a?this.y=-1:"83"==a?this.y=1:"32"==a&&(this.jump=!0)};se.Joystick.prototype.reset=function(){this.y=this.x=0;this.jump=!1};se.Joystick.prototype.getAxis=function(a){return"horizontal"==a?this.x:"vertical"==a?this.y:"jump"==a?this.jump:0};se.Joystick.prototype.setAxis=function(a,b){"horizontal"==a&&(this.x=b);"vertical"==a&&(this.y=b);"jump"==a&&(this.jump=b)};
se.Joystick.prototype.resetAxis=function(a,b){this.y=this.x=0;this.jump=!1};se.ComponentScript=function(a){this.update=a};se.ComponentScript.prototype.setParent=function(a){this.parent=a};se.ComponentPlayerController=function(a,b,c){this.window=a;this.speed=b};se.ComponentPlayerController.prototype.update=function(a){var b=game.joystick.getAxis("horizontal")*this.speed;b&&a.sum(b,0);game.joystick.getAxis("jump")&&a.sum(0,-2*this.speed)};
se.ComponentPlayerController.prototype.setParent=function(a){this.parent=a};se.ComponentFollowPlayer=function(a){this.obj_player=a};se.ComponentFollowPlayer.prototype.update=function(a){var b=this.parent.parent,c=b.getWidth()/2-this.obj_player.getWidth()/2,c=this.obj_player.getX()+this.obj_player.getWidth()/2-c,b=b.getHeight()/2-this.obj_player.getHeight()/2,b=this.obj_player.getY()+this.obj_player.getHeight()/2-b;a.move(c,b)};se.ComponentFollowPlayer.prototype.setParent=function(a){this.parent=a};
se.ComponentRigidBody=function(a){this.gravity=a};se.ComponentRigidBody.prototype.update=function(a){a.sum(0,this.gravity)};se.ComponentRigidBody.prototype.setParent=function(a){this.parent=a};se.BoxRenderer=function(a){this.color=a};se.BoxRenderer.prototype.render=function(a){var b=this.parent,c=b.transform.position;a.fillStyle=this.color;a.fillRect(c.x,c.y,b.width,b.height)};se.BoxRenderer.prototype.setParent=function(a){this.parent=a};
se.BoxCollider=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};se.BoxCollider.prototype.setParent=function(a){this.parent=a};se.BoxCollider.prototype.getPoints=function(){var a=this.parent,b=a.getX()+this.x,a=a.getY()+this.y,c=this.width,d=this.height,e=[];e.push([b,a]);e.push([b+c,a]);e.push([b,a+d]);e.push([b+c,a+d]);return e};
se.BoxCollider.prototype.isIntersect=function(a){var b=this.getPoints(),c=a.getPoints();a=c[0];var c=c[3],d;for(d in b)if(b[d][0]>a[0]&&b[d][0]<c[0]&&b[d][1]>a[1]&&b[d][1]<c[1])return!0;return!1};
