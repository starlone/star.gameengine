<!DOCTYPE html>
<html>
  <head>
    <title>Star Engine</title>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height"/>

    <script type="text/javascript" src="../libs/matter.min.js"></script>
    <script type="text/javascript" src="../starengine.min.js"></script>
    <script type="text/javascript">
        window.onload = function(){
            var game = new se.StarEngine('canvas');

            var renderer = new se.GradientRenderer('#004CB3','#8ED6FF');
            var scene = new se.Scene(game, renderer);
            game.addScene(scene);

            var ground = new se.GameObject('ground', 0, 200, 2800, 100, {isStatic: true});
            ground.setRigidBody( new se.RigidBodyMatter() );
            ground.setRenderer( new se.BoxRenderer('#6B4226') );
            scene.add(ground);

            var box = new se.GameObject('box', 280, -50, 80, 80);
            box.setRigidBody( new se.RigidBodyMatter() );
            box.setRenderer( new se.ImageRenderer('box.jpg') );
            scene.add(box);

            var box = new se.GameObject('box2', 220, 50, 80, 80);
            box.setRigidBody( new se.RigidBodyMatter() );
            box.setRenderer( new se.ImageRenderer('box.jpg') );
            scene.add(box);

			var obj_player = new se.GameObject('Player', 20, -50, 50, 50, {canRotate: false});
            obj_player.addComponent( new se.ComponentPlatformPlayerController(game.joystick, 0.5, 400, 400) );
            obj_player.setRigidBody( new se.RigidBodyMatter() );
            obj_player.setRenderer( new se.BoxRenderer('#dddddd') );
            scene.add(obj_player);

            var player_eye = new se.GameObject('PlayerEye', 10, -8, 15, 10);
            player_eye.setRenderer( new se.BoxRenderer('blue') );
            obj_player.addChild(player_eye);

            scene.getCamera().addComponent( new se.ComponentFollowObject(obj_player));

            game.run();

            // Buttons
            // B1
            var b1 = document.getElementById('b1');
            var b1start = function(){
                game.joystick.setAxis('horizontal',-1);
            };
            b1.addEventListener('mousedown', b1start);
            b1.addEventListener('touchstart', b1start);
            var b1end   = function(){
                game.joystick.setAxis('horizontal',0);
            };
            b1.addEventListener('mouseup', b1end);
            b1.addEventListener('touchend', b1end);

            // B2
            var b2 = document.getElementById('b2');
            var b2start = function(){
                game.joystick.setAxis('horizontal',1);
            };
            b2.addEventListener('mousedown', b2start);
            b2.addEventListener('touchstart', b2start);
            var b2end   = function(){
                game.joystick.setAxis('horizontal',0);
            };
            b2.addEventListener('mouseup', b2end);
            b2.addEventListener('touchend', b1end);

            // B3
            var b3 = document.getElementById('b3');
            var b3start = function(){
                game.joystick.setAxis('jump',true);
            };
            b3.addEventListener('mousedown', b3start);
            b3.addEventListener('touchstart', b3start);
            var b3end   = function(){
                game.joystick.setAxis('jump',false);
            };
            b3.addEventListener('mouseup', b3end);
            b3.addEventListener('touchend', b3end);
        };
    </script>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }
        body, html {
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        canvas { 
            border: 1px solid black; 
        }
        .se-joy-buttons{
            display: block;
            position: absolute;
            bottom: 40px;
        }
        .se-joy-buttons span{
            padding: 10px 20px;
            border: 1px solid black;
            background-color: #CCC;
            font-size: 37px;
        }
        #b1{
            left: 30px;
        }
        #b2{
            left: 100px;
        }
        #b3{
            right: 30px;
        }
        html {
            -webkit-user-select: none;
        }
    </style>
  </head>
  <body>
      <canvas id="canvas" width="600" height="600"></canvas>
      <div id="b1" class="se-joy-buttons">
          <span href="#"> < </span>
      </div>
      <div id="b2" class="se-joy-buttons">
          <span href="#"> > </span>
      </div>
      <div id="b3" class="se-joy-buttons">
          <span href="#"> ^ </span>
      </div>
  </body>
</html>
